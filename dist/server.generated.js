module.exports=function(e){var t={};function a(r){if(t[r])return t[r].exports;var n=t[r]={i:r,l:!1,exports:{}};return e[r].call(n.exports,n,n.exports,a),n.l=!0,n.exports}return a.m=e,a.c=t,a.d=function(e,t,r){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(a.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)a.d(r,n,function(t){return e[t]}.bind(null,n));return r},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="/dist/",a(a.s=83)}([function(e,t){e.exports=require("react")},function(e,t){e.exports=require("@material-ui/core/Typography")},function(e,t){e.exports=require("react-router-dom")},function(e,t){e.exports=require("@material-ui/core/styles")},function(e,t){e.exports=require("@material-ui/core/Button")},function(e,t){e.exports=require("@material-ui/core/TextField")},function(e,t){e.exports=require("@material-ui/core/Card")},function(e,t){e.exports=require("prop-types")},function(e,t){e.exports=require("@material-ui/core/Grid")},function(e,t){e.exports=require("@material-ui/core/IconButton")},function(e,t){e.exports=require("mongoose")},function(e,t){e.exports=require("@material-ui/core/Divider")},function(e,t){e.exports=require("@material-ui/core/CardContent")},function(e,t){e.exports=require("@material-ui/core/Icon")},function(e,t){e.exports=require("@material-ui/core/ListItem")},function(e,t){e.exports=require("@material-ui/core/List")},function(e,t){e.exports=require("@material-ui/core/Paper")},function(e,t){e.exports=require("@material-ui/core/Avatar")},function(e,t){e.exports=require("@material-ui/core/CardActions")},function(e,t){e.exports=require("express")},function(e,t){e.exports=require("@material-ui/core/ListItemText")},function(e,t){e.exports=require("@material-ui/core/CardMedia")},function(e,t){e.exports=require("@material-ui/core/ListItemAvatar")},function(e,t){e.exports=require("@material-ui/core/ListItemSecondaryAction")},function(e,t){e.exports=require("@material-ui/core/Dialog")},function(e,t){e.exports=require("@material-ui/core/DialogActions")},function(e,t){e.exports=require("@material-ui/core/DialogContent")},function(e,t){e.exports=require("@material-ui/core/DialogContentText")},function(e,t){e.exports=require("@material-ui/core/DialogTitle")},function(e,t){e.exports=require("@material-ui/icons/AddPhotoAlternate")},function(e,t){e.exports=require("formidable")},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("@material-ui/icons/Add")},function(e,t){e.exports=require("@material-ui/icons/Visibility")},function(e,t){e.exports=require("@material-ui/icons/Edit")},function(e,t){e.exports=require("@material-ui/icons/Delete")},function(e,t){e.exports=require("lodash/extend")},function(e,t){e.exports=require("@material-ui/core/Chip")},function(e,t){e.exports=require("@material-ui/icons/Done")},function(e,t){e.exports=require("@material-ui/core/MenuItem")},function(e,t){e.exports=require("react-stripe-elements")},function(e,t){e.exports=require("@material-ui/core/GridList")},function(e,t){e.exports=require("@material-ui/core/GridListTile")},function(e,t){e.exports=require("@material-ui/icons/Person")},function(e,t){e.exports=require("@material-ui/icons/VisibilityOff")},function(e,t){e.exports=require("@material-ui/core/InputAdornment")},function(e,t){e.exports=require("@material-ui/core/CardHeader")},function(e,t,a){"use strict";a.r(t),a.d(t,"signin",(function(){return r})),a.d(t,"signout",(function(){return n}));const r=async e=>{try{let t=await fetch("/auth/signin",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},credentials:"include",body:JSON.stringify(e)});const a=await t.json();return console.log(a),a}catch(e){console.log(e)}},n=async()=>{try{return(await fetch("/auth/signout/",{method:"GET"})).json()}catch(e){console.log(e)}}},function(e,t){e.exports=require("body-parser")},function(e,t){e.exports=require("@material-ui/styles")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("cookie-parser")},function(e,t){e.exports=require("compression")},function(e,t){e.exports=require("cors")},function(e,t){e.exports=require("helmet")},function(e,t){e.exports=require("react-dom/server")},function(e,t){e.exports=require("react-router-dom/StaticRouter")},function(e,t){e.exports=require("@material-ui/core/AppBar")},function(e,t){e.exports=require("@material-ui/core/Toolbar")},function(e,t){e.exports=require("@material-ui/icons/Home")},function(e,t){e.exports=require("@material-ui/icons/ShoppingCart")},function(e,t){e.exports=require("@material-ui/core/Badge")},function(e,t){e.exports=require("querystring")},function(e,t){e.exports=require("@material-ui/icons/Search")},function(e,t){e.exports=require("@material-ui/core/GridListTileBar")},function(e,t){e.exports=require("@material-ui/icons/AddShoppingCart")},function(e,t){e.exports=require("@material-ui/icons/RemoveShoppingCart")},function(e,t){e.exports=require("@material-ui/icons/ArrowForward")},function(e,t){e.exports=require("@material-ui/core/FormControlLabel")},function(e,t){e.exports=require("@material-ui/core/Switch")},function(e,t){e.exports=require("@material-ui/icons/Face")},function(e,t){e.exports=require("@material-ui/icons/LocalGroceryStore")},function(e,t){e.exports=require("@material-ui/icons/ImportantDevices")},function(e,t){e.exports=require("@material-ui/icons/CastForEducation")},function(e,t){e.exports=require("@material-ui/icons/Fastfood")},function(e,t){e.exports=require("@material-ui/icons/HomeWork")},function(e,t){e.exports=require("@material-ui/icons/ExpandLess")},function(e,t){e.exports=require("@material-ui/icons/ExpandMore")},function(e,t){e.exports=require("@material-ui/core/Collapse")},function(e,t){e.exports=require("@material-ui/core/colors")},function(e,t){e.exports=require("crypto")},function(e,t){e.exports=require("express-jwt")},function(e,t){e.exports=require("jsonwebtoken")},function(e,t,a){e.exports=a(86)},function(e,t){e.exports=require("socket.io-client")},function(e,t){e.exports=require("socket.io")},function(e,t,a){"use strict";a.r(t);var r={env:"production",PORT:process.env.PORT||3e3,jwtSecret:process.env.JWT_SECRET||"Make person no tell me say i too lazy",mongoUri:process.env.MONGODB_URI||process.env.MONGO_HOST||"mongodb://"+(process.env.IP||"localhost")+":"+(process.env.MONGO_PORT||"27017")+"/mernprojectv11",stripe_connect_test_client_id:" your strip test cclient id",stripe_test_secret_key:"sk_test_51H84iCHJ1zBczfLrEw5pdHrmTEyo3DYQyds1E8zEFMUp11ify3S8mmmIgCz1d90hfm1uj7veF26WQIFOSpwvH2VW00eBkaywhp",stripe_test_api_key:"pk_test_51H84iCHJ1zBczfLrgtoKcRcnoBs6GpIabvuJDHY9NXK09napgjLSDXLDZcsTJ2vc2GBplcigv6ivWErf3YaXIlLp00dgepJ47J"},n=a(50),o=a.n(n),i=a(19),l=a.n(i),c=a(48),s=a.n(c),m=a(51),d=a.n(m),p=a(52),u=a.n(p),g=a(53),h=a.n(g),E=a(54),y=a.n(E),b=a(0),f=a.n(b),x=a(55),v=a.n(x),w=a(56),S=a.n(w),j=a(2);const{signout:k}=a(47);function N(){return"undefined"!=typeof window&&(!!sessionStorage.getItem("jwt")&&JSON.parse(sessionStorage.getItem("jwt")))}function I(e){"undefined"!=typeof window&&sessionStorage.removeItem("jwt"),e(),k.then(e=>{document.cookie="t=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;"})}function T(){return(T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var r in a)Object.prototype.hasOwnProperty.call(a,r)&&(e[r]=a[r])}return e}).apply(this,arguments)}var C=({component:e,...t})=>f.a.createElement(j.Route,T({},t,{render:t=>N()?f.a.createElement(e,t):f.a.createElement(j.Redirect,{to:{pathname:"/signin",state:{from:t.location}}})})),q=a(57),O=a.n(q),_=a(58),A=a.n(_),D=a(1),B=a.n(D),F=a(9),R=a.n(F),L=a(59),P=a.n(L),$=a(4),z=a.n($),M=a(60),U=a.n(M),G=a(61),W=a.n(G);const H=()=>"undefined"!=typeof window&&localStorage.getItem("cart")?JSON.parse(localStorage.getItem("cart")):[],J=(e,t)=>e.location.pathname==t?{color:"#ff4081"}:{color:"#ffffff"},V=(e,t)=>e.location.pathname.includes(t)?{color:"#bef67a"}:{color:"#ffffff"};var Q=Object(j.withRouter)(({history:e})=>f.a.createElement(O.a,{position:"static"},f.a.createElement(A.a,null,f.a.createElement(B.a,{variant:"h6",color:"inherit"},"MERN MarketPlace"),f.a.createElement(j.Link,{to:"/"},f.a.createElement(R.a,{"aria-label":"Home",style:J(e,"/")},f.a.createElement(P.a,null))),f.a.createElement(j.Link,{to:"/users"},f.a.createElement(z.a,{style:J(e,"/users")},"Users")),f.a.createElement(j.Link,{to:"/shops/all"},f.a.createElement(z.a,{style:J(e,"/shops/all")},"View Shops")),f.a.createElement(j.Link,{to:"/cart"},f.a.createElement(z.a,{style:J(e,"/cart")},"Cart",f.a.createElement(W.a,{color:"secondary",badgeContent:"undefined"!=typeof window&&localStorage.getItem("cart")?JSON.parse(localStorage.getItem("cart")).length:0,style:{marginLeft:"7px"},invisible:!1},f.a.createElement(U.a,null)))),f.a.createElement("div",{style:{position:"absolute",right:"10px"}},f.a.createElement("span",{style:{float:"right"}},!N()&&f.a.createElement("span",null,f.a.createElement(j.Link,{to:"/signup"},f.a.createElement(z.a,{style:J(e,"/signup")},"Sign up")),f.a.createElement(j.Link,{to:"/signin"},f.a.createElement(z.a,{style:J(e,"/signin")},"Sign In"))),N()&&f.a.createElement("span",null,N().user.seller&&f.a.createElement(j.Link,{to:"/seller/shops"},f.a.createElement(z.a,{style:V(e,"/seller/")},"My Shops")),f.a.createElement(j.Link,{to:"/user/"+N().user._id},f.a.createElement(z.a,{style:J(e,"/user/"+N().user._id)},"My Profile")),f.a.createElement(z.a,{color:"inherit",onClick:()=>{I(()=>e.push("/"))}},"Sign out"))))))),Y=a(3),Z=a(8),K=a.n(Z),X=a(7),ee=a.n(X),te=a(16),ae=a.n(te),re=a(33),ne=a.n(re),oe=a(13),ie=a.n(oe),le=a(11),ce=a.n(le),se=a(6),me=a.n(se),de=a(12),pe=a.n(de),ue=a(21),ge=a.n(ue);const he=Object(Y.makeStyles)(e=>({root:e.mixins.gutters({padding:e.spacing(1),paddingBottom:24,backgroundColor:"#80808024"}),title:{margin:`${e.spacing(4)}px 0 ${e.spacing(2)}px`,color:e.palette.openTitle,fontSize:"1.1em",textAlign:"right"},viewButton:{verticalAlign:"middle"},card:{width:"100%",display:"inline-flex"},details:{display:"inline-block",width:"100%"},content:{flex:"1 0 auto",padding:"16px 8px 0px"},cover:{width:"65%",height:130,margin:"8px"},controls:{marginTop:"8px"},date:{color:"rgba(0, 0, 0, 0.4)"},icon:{verticalAlign:"sub"},iconButton:{width:"28px",height:"28px"},productTitle:{fontSize:"1.15em",marginBottom:"5px"},subheading:{color:"rgba(88, 114, 128, 0.67)"},actions:{float:"right",marginRight:"6px"},price:{display:"inline",lineHeight:"3",paddingLeft:"8px",color:e.palette.text.secondary}})),Ee=e=>{const t=he();return f.a.createElement("div",null,f.a.createElement(ae.a,{className:t.root,elevation:4},f.a.createElement(B.a,{title:"title",className:t.title},e.title),e.products.map((e,a)=>f.a.createElement("span",{key:a},f.a.createElement(me.a,{className:t.card},f.a.createElement(ge.a,{className:t.cover,image:"/api/product/image/"+e._id,title:e.name}),f.a.createElement("div",{className:t.details},f.a.createElement(pe.a,{className:t.content},f.a.createElement(j.Link,{to:"/product/"+e._id},f.a.createElement(B.a,{component:"h3",color:"primary",variant:"h3",className:t.productTitle},e.name)),f.a.createElement(j.Link,{to:"/shops/"+e.shop._id},f.a.createElement(B.a,{type:"subheading",className:t.subheading},e.shop.name)),f.a.createElement(B.a,{component:"p",className:t.date},"Added on",new Date(e.created).toDateString())),f.a.createElement("div",{className:t.controls},f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.price,color:"primary"},e.price),f.a.createElement("span",{className:t.actions},f.a.createElement(j.Link,{to:"/product/"+e._id},f.a.createElement(R.a,{color:"secondary",dense:"dense"},f.a.createElement(ne.a,{className:t.iconButton}))))))),f.a.createElement(ce.a,null)))))};Ee.propTypes={products:ee.a.array.isRequired,title:ee.a.string.isRequired};var ye=Ee,be=a(62),fe=a.n(be);const xe=async(e,t)=>{console.log(e);try{return(await fetch("/api/products/"+e.productId,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},signal:t})).json()}catch(e){console.log(e)}},ve=async(e,t)=>{try{return(await fetch("/api/products/by/"+e.shopId,{method:"GET",signal:t})).json()}catch(e){console.log(e)}},we=e=>{const t=fe.a.stringify(e);return fetch("/api/products?"+t,{method:"GET"}).then(e=>e.json()).catch(e=>console.log(e))};var Se=a(39),je=a.n(Se),ke=a(5),Ne=a.n(ke),Ie=a(63),Te=a.n(Ie),Ce=a(41),qe=a.n(Ce),Oe=a(42),_e=a.n(Oe),Ae=a(64),De=a.n(Ae),Be=a(65),Fe=a.n(Be),Re=a(66),Le=a.n(Re);const Pe=Object(Y.makeStyles)(e=>({iconButton:{width:"28px",height:"28px"},disabledIconButton:{color:"#7f7563",width:"28px",height:"28px"}})),$e=e=>{const t=Pe(),[a,r]=Object(b.useState)(!1);return a?f.a.createElement(j.Redirect,{to:"/cart"}):f.a.createElement("span",null,e.item.quantity>=0?f.a.createElement(R.a,{color:"secondary",dense:"dense",onClick:()=>{((e,t)=>{let a=[];"undefined"!=typeof window&&(localStorage.getItem("cart")&&(a=JSON.parse(localStorage.getItem("cart"))),a.push({product:e,quantity:1,shop:e.shop._id}),localStorage.setItem("cart",JSON.stringify(a)),t())})(e.item,()=>{r({redirect:!0})})}},f.a.createElement(Fe.a,{className:e.cartStyle||t.iconButton})):f.a.createElement(R.a,{disabled:!0,color:"secondary",dense:"dense"},f.a.createElement(Le.a,{className:e.cartStyle||t.disabledIconButton})))};$e.propTypes={item:ee.a.object.isRequired,cartStyle:ee.a.string};var ze=$e;const Me=Object(Y.makeStyles)(e=>({root:{display:"flex",flexWrap:"wrap",justifyContent:"space-around",overflow:"hidden",background:e.palette.background.paper,textAlign:"left",padding:"0 8px"},container:{minWidth:"100%",paddingBottom:"14px"},gridList:{width:"100%",minHeight:200,padding:"16px 0 10px"},title:{padding:`${e.spacing(3)}px ${e.spacing(2.5)}px ${e.spacing(2)}px`,color:e.palette.openTitle,width:"100%"},tile:{textAlign:"center"},image:{height:"100%"},tileBar:{backgroundColor:"rgba(0, 0, 0, 0.72)",textAlign:"left"},tileTitle:{fontSize:"1.1em",marginBottom:"5px",color:"rgb(189, 222, 219)",display:"block"}})),Ue=e=>{const t=Me();return f.a.createElement("div",{className:t.root},e.products.length>0?f.a.createElement("div",{className:t.container},f.a.createElement(qe.a,{cellHeight:200,className:t.gridList,cols:3},e.products.map((e,a)=>f.a.createElement(_e.a,{key:a,className:t.tile},f.a.createElement(j.Link,{to:"/product/"+e._id},f.a.createElement("img",{className:t.image,src:"/api/product/image/"+e._id,alt:e.name})),f.a.createElement(De.a,{className:t.tileBar,title:f.a.createElement(j.Link,{className:t.tileTitle,to:"/product/"+e._id},e.name),subtitle:f.a.createElement("span",null,"$",e.price),actionIcon:f.a.createElement(ze,{item:e})}))))):e.searched&&f.a.createElement(B.a,{component:"h4"},"No products found!"))};Ue.propTypes={products:ee.a.array.isRequired,searched:ee.a.bool.isRequired};var Ge=Ue;const We=Object(Y.makeStyles)(e=>({card:{margin:"auto",textAlign:"center",paddingTop:10,backgroundColor:"#80808024"},menu:{width:200},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:130,verticalAlign:"bottom",marginBottom:"20px"},searchField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:300,marginBottom:"20px"},searchButton:{minWidth:"20px",height:"30px",padding:"0 8px",marginBottom:"20px"}}));var He=e=>{const t=We(),[a,r]=Object(b.useState)({category:"",search:"",results:[],searched:!1}),n=e=>t=>{r({...a,[e]:t.target.value})},o=()=>{a.search&&we({search:a.search||void 0,category:a.category}).then(e=>{e.error?console.log(e.error):r({...a,results:e,searched:!0})})};return f.a.createElement("div",null,f.a.createElement(me.a,{className:t.card},f.a.createElement(Ne.a,{id:"select-category",select:!0,label:"Select category",className:t.textField,value:a.category,onChange:n("category"),SelectProps:{MenuProps:{className:t.menu}},margin:"normal"},f.a.createElement(je.a,{value:"All"},"All"),e.categories.map(e=>f.a.createElement(je.a,{key:e,value:e},e))),f.a.createElement(Ne.a,{id:"search",label:"Search products",type:"search",onKeyDown:e=>{13==e.keyCode&&(e.preventDefault(),o())},onChange:n("search"),className:t.searchField,margin:"normal"}),f.a.createElement(z.a,{variant:"contained",onClick:o,color:"primary",className:t.searchButton},f.a.createElement(Te.a,null)),f.a.createElement(ce.a,null),f.a.createElement(Ge,{products:a.results,searched:a.searched})))};const Je=Object(Y.makeStyles)(e=>({root:{display:"flex",flexWrap:"wrap",justifyContent:"space-around",overflow:"hidden",background:e.palette.background.paper},gridList:{flexWrap:"nowrap",width:"100%",transform:"translateZ(0)"},tileTitle:{verticalAlign:"middle",lineHeight:2.5,textAlign:"center",fontSize:"1.35em",margin:"0 4px 0 0"},card:{margin:"auto",marginTop:20},title:{padding:`${e.spacing(3)}px ${e.spacing(2.5)}px ${e.spacing(2)}px`,color:e.palette.openTitle,backgroundColor:"#80808024",fontSize:"1.1em"},icon:{verticalAlign:"sub",color:"#738272",fontSize:"0.9em"},link:{color:"#4d6538",textShadow:"0px 2px 12px #ffffff",cursor:"pointer"}}));var Ve=e=>{const t=Je(),[a,r]=Object(b.useState)([]),[n,o]=Object(b.useState)(e.categories[0]);Object(b.useEffect)(()=>{const t=new AbortController;return we({category:e.categories[0]}).then(e=>{e.error?console.log(error):r(e)}),function(){t.abort()}},[]);return f.a.createElement("div",null,f.a.createElement(me.a,{className:t.root},f.a.createElement(B.a,{type:"title",className:t.title},"Explore by Category"),f.a.createElement("div",{className:t.root},f.a.createElement(qe.a,{className:t.gridList,cols:4},e.categories.map((e,a)=>{_e.a,t.tileTitle,t.link,ie.a,t.icon}))),f.a.createElement(ce.a,null),f.a.createElement(Ge,{products:a,searched:!1})))},Qe=a(15),Ye=a.n(Qe),Ze=a(14),Ke=a.n(Ze),Xe=a(22),et=a.n(Xe),tt=a(23),at=a.n(tt),rt=a(20),nt=a.n(rt),ot=a(17),it=a.n(ot),lt=a(34),ct=a.n(lt),st=a(35),mt=a.n(st),dt=a(24),pt=a.n(dt),ut=a(25),gt=a.n(ut),ht=a(26),Et=a.n(ht),yt=a(27),bt=a.n(yt),ft=a(28),xt=a.n(ft);const vt=e=>{const[t,a]=Object(b.useState)(!1),r=N(),n=()=>{a(!0)};return console.log(e),f.a.createElement("span",null,f.a.createElement(R.a,{"aria-label":"Delete",onClick:n,color:"secondary"},f.a.createElement(mt.a,null)),f.a.createElement(pt.a,{open:t,onClose:n},f.a.createElement(xt.a,null,"Delete "+e.auction.itemName),f.a.createElement(Et.a,null,f.a.createElement(bt.a,null,"Confirm to delete your auction ",f.a.createElement("strong",null,f.a.createElement("em",null,e.auction.itemName)),".")),f.a.createElement(gt.a,null,f.a.createElement(z.a,{onClick:n,color:"primary"},"Cancel"),f.a.createElement(z.a,{onClick:()=>{(async e=>{try{return(await fetch("/api/auctions/"+e.auctionId,{method:"DELETE",headers:{Accept:"application/json",Authorization:"Bearer "+e.token}})).json()}catch(e){console.log(e)}})({auctionId:e.auction._id,token:r.token}).then(t=>{t.error?console.log(t.error):(a(!1),e.onRemove(e.auction))})},color:"secondary",autoFocus:"autoFocus"},"Confirm"))))};vt.propTypes={auction:ee.a.object.isRequired,onRemove:ee.a.func.isRequired};var wt=vt;const St=e=>{const t=new Date,a=N(),r=e=>{let t=(e=>{const t=e-new Date;let a={};return a=t>0?{days:Math.floor(t/864e5),hours:Math.floor(t/36e5%24),minutes:Math.floor(t/1e3/60%60),seconds:Math.floor(t/1e3%60),timeEnd:!1}:{timeEnd:!0},a})(e);return!t.timeEnd&&f.a.createElement("span",null,0!=t.days&&t.days+" d ",0!=t.hours&&t.hours+" h ",0!=t.minutes&&t.minutes+" m ",0!=t.seconds&&t.seconds+" s"," left")},n=e=>f.a.createElement("span",null,t<new Date(e.bidStart)&&"Auction Starts at \n                  "+new Date(e.bidStart).toLocaleString(),t>new Date(e.bidStart)&&t<new Date(e.bidEnd)&&f.a.createElement(f.a.Fragment,null,`Auction is live | ${e.bids.length}\n                    bids |`," ",r(new Date(e.bidEnd))),t>new Date(e.bidEnd)&&`Auction Ended | ${e.bids.length}\n                   bids`,t>new Date(e.bidStart)&&e.bids.length>0&&" | Last bid: $ "+e.bids[0].bid);return f.a.createElement(Ye.a,{dense:!0},e.auctions.map((t,r)=>f.a.createElement("span",{key:r},f.a.createElement(Ke.a,{button:!0},f.a.createElement(et.a,null,f.a.createElement(it.a,{variant:"squared",src:`/api/auctions/image/${t._id}?${(new Date).getTime()}`})),f.a.createElement(nt.a,{primary:t.itemName,secondary:n(t)}),f.a.createElement(at.a,null,f.a.createElement(j.Link,{to:"/auction/"+t._id},f.a.createElement(R.a,{"aria-label":"View",color:"primary"},f.a.createElement(ne.a,null))),a&&a.user._id==t.seller._id&&f.a.createElement(f.a.Fragment,null,f.a.createElement(j.Link,{to:"/auction/edit/"+t._id},f.a.createElement(R.a,{"aria-label":"Edit",color:"primary"},f.a.createElement(ct.a,null))),f.a.createElement(wt,{auction:t,onRemove:e.removeAuction})))),f.a.createElement(ce.a,null))))};St.propTypes={auctions:ee.a.array.isRequired,removeAuction:ee.a.func.isRequired};var jt=St;const kt=Object(Y.makeStyles)(e=>({root:{flexGrow:1,margin:30}}));var Nt=()=>{const e=kt(),[t,a]=f.a.useState([]),[r,n]=f.a.useState([]),[o,i]=f.a.useState([]);f.a.useEffect(()=>{const e=new AbortController;return(async e=>{try{return(await fetch("/api/auctions",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},signal:e})).json()}catch(e){console.log(e)}})(e.signal).then(e=>{e.error?console.log(e.error):(console.log(e),i(e))}),function(){e.abort()}},[]),f.a.useEffect(()=>{const e=new AbortController;return(async e=>{try{return(await fetch("/api/products/latest",{method:"GET",signal:e})).json()}catch(e){console.log(e)}})(e.signal).then(e=>{e.error?console.log(e.error):a(e)}),function(){e.abort()}},[]),f.a.useEffect(()=>{const e=new AbortController;return(async e=>{console.log("calling the list category");try{return(await fetch("/api/products/categories",{method:"GET",signal:e})).json()}catch(e){console.log(e)}})(e.signal).then(e=>{e.error?(console.log("there bess an error"),console.log(e.error)):n(e)}),function(){e.abort()}},[]);return f.a.createElement("div",{className:e.root},f.a.createElement(K.a,{container:!0,spacing:2},f.a.createElement(K.a,{item:!0,xs:8,sm:8},f.a.createElement(He,{categories:r}),f.a.createElement(Ve,{categories:r})),f.a.createElement(K.a,{item:!0,xs:4,sm:4},f.a.createElement(ye,{products:t,title:"Latest Products"})),f.a.createElement(K.a,{item:!0,xs:12,sm:12},f.a.createElement(B.a,{variant:"subtitle1"},"List Of Available Bids"),f.a.createElement(jt,{auctions:o,removeAuction:e=>{const t=[o],a=t.indexOf(e);t.splice(a,1),i([...t])}}))))},It=a(67),Tt=a.n(It),Ct=a(43),qt=a.n(Ct);const Ot=async(e,t)=>{try{let a=await fetch("/api/user/"+e.userId,{method:"GET",signal:t,headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.token}});return await a.json()}catch(e){console.log(e)}},_t=async(e,t)=>{try{let a=await fetch("/api/user/"+e.userId,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.token},body:JSON.stringify(t)});return await a.json()}catch(e){console.log(e)}},At=Object(Y.makeStyles)(e=>({root:e.mixins.gutters({padding:e.spacing(1),margin:e.spacing(5)}),title:{margin:`${e.spacing(4)}px 0 ${e.spacing(2)}px`,color:e.palette.openTitle}}));var Dt=e=>{const t=At(),[a,r]=f.a.useState([]);return f.a.useEffect(()=>{const e=new AbortController;return(async e=>{try{let t=await fetch("/api/user",{method:"GET",signal:e});return await t.json()}catch(e){console.log(e)}})(e.signal).then(e=>{e&&e.error?console.log(e.error):r(e)}),function(){e.abort()}},[]),f.a.createElement(ae.a,{className:t.root,elevation:4},f.a.createElement(B.a,{variant:"h6",className:t.title},"All Users"),f.a.createElement(Ye.a,{dense:!0},a.map((e,t)=>f.a.createElement(j.Link,{to:"/user/"+e._id,key:t},f.a.createElement(Ke.a,{button:!0},f.a.createElement(et.a,null,f.a.createElement(it.a,null,f.a.createElement(qt.a,null))),f.a.createElement(nt.a,{primary:e.name}),f.a.createElement(at.a,null,f.a.createElement(R.a,null,f.a.createElement(Tt.a,null))))))))},Bt=a(18),Ft=a.n(Bt),Rt=a(44),Lt=a.n(Rt),Pt=a(45),$t=a.n(Pt);const zt=Object(Y.makeStyles)(e=>({card:{maxWidth:600,margin:"auto",textAlign:"center",marginTop:e.spacing(5),paddingBottom:e.spacing(2)},error:{verticalAlign:"middle"},title:{marginTop:e.spacing(2),color:e.palette.openTitle},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:300},submit:{margin:"auto",marginBottom:e.spacing(2)}}));var Mt=()=>{const e=zt(),[t,a]=f.a.useState({name:"",password:"",email:""}),[r,n]=f.a.useState({open:!1,error:"",submit:!1}),[o,i]=f.a.useState(!0);f.a.useEffect(()=>{const e=l();n({...r,submit:!e})},[t]);const l=()=>["name","email","password"].every(e=>t[e].length>3),c=e=>r=>{a({...t,[e]:r.target.value})};return f.a.createElement(f.a.Fragment,null,f.a.createElement(me.a,{className:e.card},f.a.createElement(pe.a,null,f.a.createElement(B.a,{variant:"h6",className:e.title},"Sign Up"),f.a.createElement(Ne.a,{id:"name",label:"Name",margin:"normal",className:e.textField,value:t.name,onChange:c("name")}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"email",type:"email",label:"Email",className:e.textField,value:t.email,onChange:c("email"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"password",type:o?"text":"password",InputProps:{endAdornment:f.a.createElement($t.a,{position:"end"},f.a.createElement(R.a,{onClick:()=>{i(!o)}},o?f.a.createElement(ne.a,null):f.a.createElement(Lt.a,null)))},label:"Password",className:e.textField,value:t.password,margin:"normal",onChange:c("password")}),f.a.createElement("br",null)," ",r.error&&f.a.createElement(B.a,{component:"p",color:"error"},r.error)),f.a.createElement(Ft.a,null,f.a.createElement(z.a,{color:"primary",disabled:r.submit,className:e.submit,variant:"contained",onClick:()=>{n({...r,error:""}),(async e=>{try{let t=await fetch("/api/user",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)});return await t.json()}catch(e){console.log(e)}})(t).then(e=>{e.error?-1!==e.error.indexOf("email already exists")?n({...r,error:"Email Already Exist"}):n({...r,error:e.error}):n({...r,open:!0})})}},"Submit"))),f.a.createElement(pt.a,{open:r.open,disableBackdropClick:!0},f.a.createElement(xt.a,null,"New Title"),f.a.createElement(Et.a,null,f.a.createElement(bt.a,null,"New Account successfully created")),f.a.createElement(gt.a,null,f.a.createElement(j.Link,{to:"/signin"},f.a.createElement(z.a,{color:"primary",variant:"contained",autoFocus:"autoFocus"},"Sign In")))))},Ut=a(47);const Gt=Object(Y.makeStyles)(e=>({card:{maxWidth:600,margin:"auto",textAlign:"center",marginTop:e.spacing(5),paddingBottom:e.spacing(2)},error:{verticalAlign:"middle"},title:{marginTop:e.spacing(2),color:e.palette.openTitle},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:300},submit:{margin:"auto",marginBottom:e.spacing(2)}}));var Wt=e=>{const t=Gt(),[a,r]=f.a.useState({email:"",password:""}),[n,o]=f.a.useState({error:"",submit:!0,redirectToReferrer:!1});f.a.useEffect(()=>{const e=i();o({...n,submit:!e})},[a]);const i=()=>["email","password"].every(e=>a[e].length>3),l=e=>t=>{r({...a,[e]:t.target.value})},{redirectToReferrer:c}=n;if(c){const{from:t}=e.location.state||{from:{pathname:"/"}};return f.a.createElement(j.Redirect,{to:t})}return f.a.createElement(me.a,{className:t.card},f.a.createElement(pe.a,null,f.a.createElement(B.a,{variant:"h6",className:t.title},"Sign In"),f.a.createElement(Ne.a,{id:"email",type:"email",label:"Email",className:t.textField,value:a.email,onChange:l("email"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"password",type:"password",label:"Password",className:t.textField,value:a.password,onChange:l("password"),margin:"normal"}),f.a.createElement("br",null)," ",n.error&&f.a.createElement(B.a,{component:"p",color:"error"},n.error)),f.a.createElement(Ft.a,null,f.a.createElement(z.a,{disabled:n.submit,color:"primary",variant:"contained",onClick:()=>{Object(Ut.signin)(a).then(e=>{if(e.error)return o({...n,error:e.error});var t,a;e.token&&(t=e,a=()=>{o({...n,error:"",redirectToReferrer:!0})},"undefined"!=typeof window&&sessionStorage.setItem("jwt",JSON.stringify(t)),a())})},className:t.submit},"Submit")))};const Ht=e=>{const[t,a]=f.a.useState(!1),[r,n]=f.a.useState(!1),o=()=>{a(!t)};return r?f.a.createElement(j.Redirect,{to:"/"}):f.a.createElement("span",null,f.a.createElement(R.a,{"aria-label":"Delete",onClick:o,color:"secondary"},f.a.createElement(mt.a,null)),f.a.createElement(pt.a,{open:t,onClose:o},f.a.createElement(xt.a,null,"Delete Account"),f.a.createElement(Et.a,null,f.a.createElement(bt.a,null,"Confirm to delete your account.")),f.a.createElement(gt.a,null,f.a.createElement(z.a,{onClick:o,color:"primary"},"Cancel"),f.a.createElement(z.a,{onClick:()=>{const t=N();(async e=>{try{let t=await fetch("/api/user/"+e.userId,{method:"DELETE",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.token}});return await t.json()}catch(e){console.log(e)}})({userId:e.userId,token:t.token}).then(e=>{e&&e.error?console.log(e.error):(I(()=>console.log("deleted")),n(!0))})},color:"secondary",autoFocus:"autoFocus"},"Confirm"))))};Ht.propTypes={userId:ee.a.string.isRequired};var Jt=Ht;const Vt=Object(Y.makeStyles)(e=>({root:e.mixins.gutters({maxWidth:600,margin:"12px 24px",padding:e.spacing(3),backgroundColor:"#3f3f3f0d",margin:"2em auto"}),title:{margin:`${e.spacing(2)}px 0 12px ${e.spacing(1)}px`,color:e.palette.openTitle,textAlign:"center",fontSize:"1.7em"}}));var Qt=()=>{const e=Vt(),[t,a]=Object(b.useState)([]),r=N();return Object(b.useEffect)(()=>{const e=new AbortController,t=e.signal;return(async(e,t)=>{try{return(await fetch("/api/orders/user/"+e.userId,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.token},signal:t})).json()}catch(e){console.log(e)}})({userId:r.user._id,token:r.token},t).then(e=>{e.error?console.log(e.error):a(e)}),function(){e.abort()}},[]),f.a.createElement(ae.a,{className:e.root,elevation:4},f.a.createElement(B.a,{type:"title",className:e.title},"Your Orders"),t.length>0?f.a.createElement(Ye.a,{dense:!0},t.map((e,t)=>f.a.createElement("span",{key:e._id},f.a.createElement(j.Link,{to:"/order/"+e._id},f.a.createElement(Ke.a,{button:!0},f.a.createElement(nt.a,{primary:f.a.createElement("strong",null,"Order # "+e._id),secondary:new Date(e.created).toDateString()})))))):f.a.createElement(B.a,{style:{textAlign:"center"},variant:"body1"},"You don't have any order "))};const Yt=Object(Y.makeStyles)(e=>({root:e.mixins.gutters({maxWidth:600,margin:"auto",padding:e.spacing(3),marginTop:e.spacing(5)}),title:{marginTop:e.spacing(3),color:e.palette.protectedTitle},stripe_connect:{marginRight:"10px"},stripe_connected:{verticalAlign:"super",marginRight:"10px"},auctions:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:e.spacing(1.3,1),width:"100%","& a":{textDecoration:"none"}}}));var Zt=({match:e,history:t})=>{const a=Yt(),[r,n]=f.a.useState({}),[o,i]=f.a.useState([]),[l,c]=f.a.useState(!1),s=N();Object(b.useEffect)(()=>{const e=(new AbortController).signal;(async(e,t)=>{try{return(await fetch("/api/auctions/by/"+e.userId,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.token},signal:t})).json()}catch(e){console.log(e)}})({userId:s.user._id,token:s.token},e).then(e=>{e.error?console.log(e.error):(console.log("success",e),i(e))})},[]),f.a.useEffect(()=>{const t=new AbortController,a=t.signal;return Ot({userId:e.params.userId,token:s.token},a).then(e=>{e&&e.error?c(!0):n(e)}),function(){t.abort()}},[e.params.userId]);return l?f.a.createElement(j.Redirect,{to:"/signin"}):f.a.createElement(f.a.Fragment,null,f.a.createElement(ae.a,{className:a.root,elevation:4},f.a.createElement(B.a,{variant:"h6",className:a.title},"Profile"),f.a.createElement(Ye.a,{dense:!0},f.a.createElement(Ke.a,null,f.a.createElement(et.a,null,f.a.createElement(it.a,null,f.a.createElement(qt.a,null))),f.a.createElement(nt.a,{primary:r.name,secondary:r.email}),s&&s.user._id==r._id&&f.a.createElement(at.a,null,f.a.createElement(j.Link,{to:"/user/edit/"+r._id},f.a.createElement(R.a,{"aria-label":"Edit",color:"primary"},f.a.createElement(ct.a,null))),f.a.createElement(Jt,{userId:r._id}))),f.a.createElement(ce.a,null),f.a.createElement(Ke.a,null,f.a.createElement(nt.a,{primary:"Joined: "+new Date(r.created).toDateString()}))),f.a.createElement(Qt,null),f.a.createElement(ae.a,{className:a.auctions,elevation:4},f.a.createElement(B.a,{style:{display:"inline"},type:"title",color:"primary"},"Auctions you created"),f.a.createElement(j.Link,{style:{display:"inline"},to:"/auction/new"},f.a.createElement(z.a,{color:"primary",variant:"contained"},"Create A New Auction")),f.a.createElement(jt,{auctions:o,removeAuction:e=>{console.log(e);const t=[o],a=t.indexOf(e);t.splice(a,1),i([...t])}}))))},Kt=a(68),Xt=a.n(Kt),ea=a(69),ta=a.n(ea);const aa=Object(Y.makeStyles)(e=>({card:{maxWidth:600,margin:"auto",textAlign:"center",marginTop:e.spacing(5),paddingBottom:e.spacing(2)},title:{margin:e.spacing(2),color:e.palette.protectedTitle},error:{verticalAlign:"middle"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:300},submit:{margin:"auto",marginBottom:e.spacing(2)},subheading:{marginTop:e.spacing(2),color:e.palette.openTitle}}));var ra=({match:e})=>{const t=aa(),[a,r]=Object(b.useState)({name:"",password:"",email:"",seller:!1}),[n,o]=Object(b.useState)({open:!1,error:"",userId:"",redirectToProfile:!1}),[i,l]=Object(b.useState)(!1),c=N();Object(b.useEffect)(()=>{const t=new AbortController,i=t.signal;return Ot({userId:e.params.userId,token:c.token},i).then(e=>{e&&e.error?o({...n,error:e.error}):r({...a,name:e.name,email:e.email})}),function(){t.abort()}},[e.params.userId]);const s=e=>t=>{r({...a,[e]:t.target.value})};return n.redirectToProfile?f.a.createElement(j.Redirect,{to:"/user/"+n.userId}):f.a.createElement(me.a,{className:t.card},f.a.createElement(pe.a,null,f.a.createElement(B.a,{variant:"h6",className:t.title},"Edit Profile"),f.a.createElement(Ne.a,{id:"name",label:"Name",className:t.textField,value:a.name,onChange:s("name"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"email",type:"email",label:"Email",className:t.textField,value:a.email,onChange:s("email"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"password",type:i?"text":"password",label:"Password",autoFocus:!1,className:t.textField,value:a.password,onChange:s("password"),margin:"normal",InputProps:{endAdornment:f.a.createElement($t.a,{position:"end"},f.a.createElement(R.a,{onClick:()=>{l(!i)}},i?f.a.createElement(ne.a,null):f.a.createElement(Lt.a,null)))}}),f.a.createElement(B.a,{variant:"subtitle1",className:t.subheading},"Seller Account"),f.a.createElement(Xt.a,{control:f.a.createElement(ta.a,{classes:{checked:t.checked,bar:t.bar},checked:a.seller,onChange:(e,t)=>{r({...a,seller:t})}}),label:a.seller?"Active":"Inactive"}),f.a.createElement("br",null)," ",n.error&&f.a.createElement(B.a,{component:"p",color:"error"},n.error)),f.a.createElement(Ft.a,null,f.a.createElement(z.a,{color:"primary",variant:"contained",className:t.submit,onClick:()=>{_t({userId:e.params.userId,token:c.token},{...a}).then(e=>{console.log(e),e&&e.error?o({...n,error:e.error}):(o({...n,redirectToProfile:!0}),function(e,t){if("undefined"!=typeof window&&sessionStorage.getItem("jwt")){let a=JSON.parse(sessionStorage.getItem("jwt"));a.user=e,sessionStorage.setItem("jwt",JSON.stringify(a)),t()}}(e,()=>{o({...n,userId:e._id,redirectToProfile:!0})}))})}},"Submit")))},na=a(29),oa=a.n(na);const ia=async(e,t)=>{try{const a=await fetch("/api/shop/"+e.shopId,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},signal:t});return await a.json()}catch(e){console.log(e)}},la=Object(Y.makeStyles)(e=>({card:{maxWidth:600,margin:"auto",textAlign:"center",marginTop:e.spacing(5),paddingBottom:e.spacing(2)},error:{verticalAlign:"middle"},title:{marginTop:e.spacing(2),color:e.palette.openTitle,fontSize:"1em"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:300},submit:{margin:"auto",marginBottom:e.spacing(2)},input:{display:"none"},filename:{marginLeft:"10px"}}));var ca=e=>{const t=la(),[a,r]=Object(b.useState)({name:"",description:"",image:""}),[n,o]=Object(b.useState)({redirect:!1,error:""}),i=N(),l=e=>t=>{const n="image"===e?t.target.files[0]:t.target.value;r({...a,[e]:n})};return n.redirect?f.a.createElement(j.Redirect,{to:"/seller/shops"}):f.a.createElement("div",null,f.a.createElement(me.a,{className:t.card},f.a.createElement(pe.a,null,f.a.createElement(B.a,{type:"headline",component:"h2",className:t.title},"New Shop"),f.a.createElement("br",null),f.a.createElement("input",{accept:"image/*",onChange:l("image"),className:t.input,id:"icon-button-file",type:"file"}),f.a.createElement("label",{htmlFor:"icon-button-file"},f.a.createElement(z.a,{variant:"contained",color:"secondary",component:"span"},"Upload Logo",f.a.createElement(oa.a,null)))," ",f.a.createElement("span",{className:t.filename},a.image?a.image.name:""),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"name",label:"Name",className:t.textField,value:a.name,onChange:l("name"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"multiline-flexible",label:"Description",multiline:!0,rows:"2",value:a.description,onChange:l("description"),className:t.textField,margin:"normal"}),f.a.createElement("br",null)," ",a.error&&f.a.createElement(B.a,{component:"p",color:"error"},f.a.createElement(ie.a,{color:"error",className:t.error},"error"),a.error)),f.a.createElement(Ft.a,null,f.a.createElement(z.a,{color:"primary",variant:"contained",onClick:()=>{let e=new FormData;a.name&&e.append("name",a.name),a.description&&e.append("description",a.description),a.image&&e.append("image",a.image),(async(e,t)=>{try{return(await fetch("/api/shops/by/"+e.userId,{method:"POST",headers:{Accept:"application/json",Authorization:"Bearer "+e.token},body:t})).json()}catch(e){console.log(e)}})({userId:i.user._id,token:i.token},e).then(e=>{e.error?r({...a,error:e.error}):o({...n,error:"",redirect:!0})})},className:t.submit},"Submit"),f.a.createElement(j.Link,{to:"/seller/shops",className:t.submit},f.a.createElement(z.a,{variant:"contained"},"Cancel")))))};const sa=Object(Y.makeStyles)(e=>({root:e.mixins.gutters({maxWidth:600,margin:"auto",padding:e.spacing(3),marginTop:e.spacing(5),marginBottom:e.spacing(3)}),title:{margin:`${e.spacing(3)}px 0 ${e.spacing(2)}px`,color:e.palette.protectedTitle,textAlign:"center",fontSize:"1.2em"},avatar:{width:100,height:100},subheading:{color:e.palette.text.secondary},shopTitle:{fontSize:"1.2em",marginBottom:"5px"},details:{padding:"24px"}}));var ma=()=>{const e=sa(),[t,a]=Object(b.useState)([]);return Object(b.useEffect)(()=>{const e=new AbortController;return(async e=>{try{return(await fetch("/api/shops",{method:"GET",signal:e})).json()}catch(e){console.log(e)}})(e.signal).then(e=>{e.error?console.log(e.error):a(e)}),function(){e.abort()}},[]),f.a.createElement("div",null,f.a.createElement(ae.a,{className:e.root,elevation:4},f.a.createElement(B.a,{type:"title",className:e.title},"All Shops"),f.a.createElement(Ye.a,{dense:!0},t.map((t,a)=>f.a.createElement(j.Link,{to:"/shops/"+t._id,key:a},f.a.createElement(ce.a,null),f.a.createElement(Ke.a,{button:!0},f.a.createElement(et.a,null,f.a.createElement(it.a,{className:e.avatar,src:"/api/shops/logo/"+t._id+"?"+(new Date).getTime()})),f.a.createElement("div",{className:e.details},f.a.createElement(B.a,{type:"headline",component:"h2",color:"primary",className:e.shopTitle},t.name),f.a.createElement(B.a,{type:"subheading",component:"h4",className:e.subheading},t.description))),f.a.createElement(ce.a,null))))))},da=a(32),pa=a.n(da);const ua=e=>{const[t,a]=Object(b.useState)(!1),r=N(),n=()=>{a(!t)};return f.a.createElement("span",null,f.a.createElement(R.a,{"aria-label":"Delete",onClick:n,color:"secondary"},f.a.createElement(mt.a,null)),f.a.createElement(pt.a,{open:t,onClose:n},f.a.createElement(xt.a,null,"Delete "+e.shop.name),f.a.createElement(Et.a,null,f.a.createElement(bt.a,null,"Confirm to delete your shop ",e.shop.name,".")),f.a.createElement(gt.a,null,f.a.createElement(z.a,{onClick:n,color:"primary"},"Cancel"),f.a.createElement(z.a,{onClick:()=>{(async e=>{console.log("successfully called ",e);try{return(await fetch("/api/shop/"+e.shopId,{method:"DELETE",headers:{Accept:"application/json",Authorization:"Bearer "+e.token}})).json()}catch(e){console.log(e)}})({shopId:e.shop._id,token:r.token}).then(r=>{r.error?console.log(r.error):(a(!t),e.onRemove(e.shop))})},color:"secondary",autoFocus:"autoFocus"},"Confirm"))))};ua.propTypes={shop:ee.a.object.isRequired,onRemove:ee.a.func.isRequired};var ga=ua;const ha=Object(Y.makeStyles)(e=>({root:e.mixins.gutters({maxWidth:600,margin:"auto",padding:e.spacing(3),marginTop:e.spacing(5)}),title:{margin:`${e.spacing(3)}px 0 ${e.spacing(3)}px ${e.spacing(1)}px`,color:e.palette.protectedTitle,fontSize:"1.2em"},addButton:{float:"right","& a":{textDecoration:"none"},"& button":{margin:e.spacing(0,.5)}},leftIcon:{marginRight:"8px"}}));var Ea=()=>{const e=ha(),[t,a]=Object(b.useState)([]),[r,n]=Object(b.useState)(!1),o=N();Object(b.useEffect)(()=>{const e=new AbortController,t=e.signal;return(async(e,t)=>{try{return(await fetch("/api/shops/by/"+e.userId,{method:"GET",signal:t,headers:{Accept:"application/json",Authorization:"Bearer "+e.token}})).json()}catch(e){console.log(e)}})({userId:o.user._id,token:o.token},t).then(e=>{e.error?n(!0):a(e)}),function(){e.abort()}},[]);const i=e=>{const r=[...t],n=r.indexOf(e);r.splice(n,1),a(r)};return f.a.createElement("div",null,f.a.createElement(ae.a,{className:e.root,elevation:4},f.a.createElement(B.a,{type:"title",className:e.title},"Your Shops",f.a.createElement("span",{className:e.addButton},f.a.createElement(j.Link,{to:"/auction/new"},f.a.createElement(z.a,{color:"primary",variant:"contained"},"Create A New Auction")),f.a.createElement(j.Link,{to:"/seller/shop/new"},f.a.createElement(z.a,{color:"secondary",variant:"contained"},"New Shop")))),f.a.createElement(Ye.a,{dense:!0},t.map((e,t)=>f.a.createElement("span",{key:t},f.a.createElement(Ke.a,{button:!0},f.a.createElement(et.a,null,f.a.createElement(it.a,{src:"/api/shops/logo/"+e._id+"?"+(new Date).getTime()})),f.a.createElement(nt.a,{primary:e.name,secondary:e.description}),o.user._id==e.owner._id&&f.a.createElement(at.a,null,f.a.createElement(j.Link,{to:"/seller/orders/"+e.name+"/"+e._id},f.a.createElement(z.a,{"aria-label":"Orders",color:"primary"},"View Orders")),f.a.createElement(j.Link,{to:`/seller/${e._id}/products/new`},f.a.createElement(R.a,{"aria-label":"Edit",color:"primary"},f.a.createElement(pa.a,null))),f.a.createElement(j.Link,{to:"/seller/shop/edit/"+e._id},f.a.createElement(R.a,{"aria-label":"Edit",color:"primary"},f.a.createElement(ct.a,null))),f.a.createElement(ga,{shop:e,onRemove:i}))),f.a.createElement(ce.a,null))))))};const ya=Object(Y.makeStyles)(e=>({root:{flexGrow:1,margin:30},card:{textAlign:"center",paddingBottom:e.spacing(2)},title:{margin:e.spacing(2),color:e.palette.protectedTitle,fontSize:"1.2em"},subheading:{marginTop:e.spacing(1),color:e.palette.openTitle},bigAvatar:{width:100,height:100,margin:"auto"},productTitle:{padding:`${e.spacing(3)}px ${e.spacing(2.5)}px ${e.spacing(1)}px ${e.spacing(2)}px`,color:e.palette.openTitle,width:"100%",fontSize:"1.2em"}}));var ba=({match:e})=>{var t,a;const[r,n]=Object(b.useState)({}),[o,i]=Object(b.useState)([]),[l,c]=Object(b.useState)(""),s=ya(),m=N();Object(b.useEffect)(()=>{const t=new AbortController,a=t.signal;return ia({shopId:e.params.shopId},a).then(e=>{e.error?c(e.error):n(e)}),function(){t.abort()}},[e.params.shopId]),Object(b.useEffect)(()=>{const t=new AbortController,a=t.signal;return ve({shopId:e.params.shopId},a).then(e=>{e.error?c(e.error):i(e)}),function(){t.abort()}},[e.params.shopId]);const d=r._id?`/api/shops/logo/${r._id}?${(new Date).getTime()}`:"/api/shops/defaultphoto",p=(null===(t=r.owner)||void 0===t?void 0:t._id)===(null===(a=m.user)||void 0===a?void 0:a._id);return f.a.createElement("div",{className:s.root},f.a.createElement(K.a,{container:!0,spacing:8},f.a.createElement(K.a,{item:!0,xs:4,sm:4},f.a.createElement(me.a,{className:s.card},f.a.createElement(pe.a,null,f.a.createElement(B.a,{type:"headline",component:"h2",className:s.title},r.name),f.a.createElement("br",null),f.a.createElement(it.a,{src:d,className:s.bigAvatar}),f.a.createElement("br",null),f.a.createElement(B.a,{type:"subheading",component:"h2",className:s.subheading},r.description),f.a.createElement("br",null),f.a.createElement(z.a,null,p&&f.a.createElement(j.Link,{to:`/seller/${r._id}/products/new`},"Add Product"))))),f.a.createElement(K.a,{item:!0,xs:8,sm:8},f.a.createElement(me.a,null,f.a.createElement(B.a,{type:"title",component:"h2",className:s.productTitle},"Products"),f.a.createElement(Ge,{products:o,searched:!1})))))};const fa=e=>{const[t,a]=Object(b.useState)(!1),r=N(),n=()=>{a(!t)};return f.a.createElement("span",null,f.a.createElement(R.a,{"aria-label":"Delete",onClick:n,color:"secondary"},f.a.createElement(mt.a,null)),f.a.createElement(pt.a,{open:t,onClose:n},f.a.createElement(xt.a,null,"Delete "+e.product.name),f.a.createElement(Et.a,null,f.a.createElement(bt.a,null,"Confirm to delete your product ",e.product.name,".")),f.a.createElement(gt.a,null,f.a.createElement(z.a,{onClick:n,color:"primary"},"Cancel"),f.a.createElement(z.a,{onClick:()=>{(async e=>{try{const t=await fetch(`/api/product/${e.shopId}/${e.productId}`,{method:"DELETE",headers:{Authorization:"Bearer "+e.token,"Content-Type":"application/json",Accept:"application/json"}});return await t.json()}catch(e){console.log(e)}})({shopId:e.shopId,productId:e.product._id,token:r.token}).then(t=>{t.error?console.log(t.error):(a(!1),e.onRemove(e.product))})},color:"secondary",autoFocus:"autoFocus"},"Confirm"))))};fa.PropTypes={shopId:ee.a.string.isRequired,product:ee.a.object.isRequired,onRemove:ee.a.func.isRequired};var xa=fa;const va=Object(Y.makeStyles)(e=>({products:{padding:"24px"},addButton:{float:"right"},leftIcon:{marginRight:"8px"},title:{margin:e.spacing(2),color:e.palette.protectedTitle,fontSize:"1.2em"},subheading:{marginTop:e.spacing(2),color:e.palette.openTitle},cover:{width:110,height:100,margin:"8px"},details:{padding:"10px"}})),wa=e=>{const t=va(),[a,r]=Object(b.useState)([]);Object(b.useEffect)(()=>{const t=new AbortController,a=t.signal;return ve({shopId:e.shopId},a).then(e=>{e.error?console.log(e.error):r(e)}),function(){t.abort()}},[]);const n=e=>{const t=[...a],n=t.indexOf(e);t.splice(n,1),r(t)};return f.a.createElement(me.a,{className:t.products},f.a.createElement(B.a,{type:"title",className:t.title},"Products",f.a.createElement("span",{className:t.addButton},f.a.createElement(j.Link,{to:"/seller/"+e.shopId+"/products/new"},f.a.createElement(z.a,{color:"primary",variant:"contained"},f.a.createElement(ie.a,{className:t.leftIcon},"add_box"),"  New Product")))),f.a.createElement(Ye.a,{dense:!0},a.map((a,r)=>f.a.createElement("span",{key:r},f.a.createElement(Ke.a,null,f.a.createElement(ge.a,{className:t.cover,image:"/api/product/image/"+a._id+"?"+(new Date).getTime(),title:a.name}),f.a.createElement("div",{className:t.details},f.a.createElement(B.a,{type:"headline",component:"h2",color:"primary",className:t.productTitle},a.name),f.a.createElement(B.a,{type:"subheading",component:"h4",className:t.subheading},"Quantity: ",a.quantity," | Price: $",a.price)),f.a.createElement(at.a,null,f.a.createElement(j.Link,{to:`/seller/${e.shopId}/${a._id}/edit`},f.a.createElement(R.a,{"aria-label":"Edit",color:"primary"},f.a.createElement(ct.a,null))),f.a.createElement(xa,{product:a,shopId:e.shopId,onRemove:n}))),f.a.createElement(ce.a,null)))))};wa.propTypes={shopId:ee.a.string.isRequired};var Sa=wa;const ja=Object(Y.makeStyles)(e=>({root:{flexGrow:1,margin:30},card:{textAlign:"center",paddingBottom:e.spacing(2)},title:{margin:e.spacing(2),color:e.palette.protectedTitle,fontSize:"1.2em"},subheading:{marginTop:e.spacing(2),color:e.palette.openTitle},error:{verticalAlign:"middle"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:400},submit:{margin:"auto",marginBottom:e.spacing(2)},bigAvatar:{width:60,height:60,margin:"auto"},input:{display:"none"},filename:{marginLeft:"10px"}}));var ka=({match:e})=>{const t=ja(),a=N(),[r,n]=Object(b.useState)({name:"",description:"",image:"",id:""}),[o,i]=Object(b.useState)({redirect:!1,error:""});Object(b.useEffect)(()=>{const t=new AbortController,a=t.signal;return ia({shopId:e.params.shopId},a).then(e=>{e.error?i({...o,error:e.error}):n({...r,id:e._id,name:e.name,description:e.description,owner:e.owner.name})}),function(){t.abort()}},[]);const l=e=>t=>{const a="image"===e?t.target.files[0]:t.target.value;n({...r,[e]:a})},c=r.id?`/api/shops/logo/${r.id}?${(new Date).getTime()}`:"/api/shops/defaultphoto";return o.redirect?f.a.createElement(j.Redirect,{to:"/seller/shops"}):f.a.createElement("div",{className:t.root},f.a.createElement(K.a,{container:!0,spacing:8},f.a.createElement(K.a,{item:!0,xs:6,sm:6},f.a.createElement(me.a,{className:t.card},f.a.createElement(pe.a,null,f.a.createElement(B.a,{type:"headline",component:"h2",className:t.title},"Edit Shop"),f.a.createElement("br",null),f.a.createElement(it.a,{src:c,className:t.bigAvatar}),f.a.createElement("br",null),f.a.createElement("input",{accept:"image/*",onChange:l("image"),className:t.input,id:"icon-button-file",type:"file"}),f.a.createElement("label",{htmlFor:"icon-button-file"},f.a.createElement(z.a,{variant:"contained",color:"default",component:"span"},"Change Logo",f.a.createElement(oa.a,null)))," ",f.a.createElement("span",{className:t.filename},r.image?r.image.name:""),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"name",label:"Name",className:t.textField,value:r.name,onChange:l("name"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"multiline-flexible",label:"Description",multiline:!0,rows:"3",value:r.description,onChange:l("description"),className:t.textField,margin:"normal"}),f.a.createElement("br",null),f.a.createElement(B.a,{type:"subheading",component:"h4",className:t.subheading},"Owner: ",r.owner),f.a.createElement("br",null),r.error&&f.a.createElement(B.a,{component:"p",color:"error"},f.a.createElement(ie.a,{color:"error",className:t.error},"error"),r.error)),f.a.createElement(Ft.a,null,f.a.createElement(z.a,{color:"primary",variant:"contained",onClick:()=>{let t=new FormData;r.name&&t.append("name",r.name),r.description&&t.append("description",r.description),r.image&&t.append("image",r.image),(async(e,t)=>{try{return(await fetch("/api/shop/"+e.shopId,{method:"PUT",headers:{Accept:"application/json",Authorization:"Bearer "+e.token},body:t})).json()}catch(e){console.log(e)}})({shopId:e.params.shopId,token:a.token},t).then(e=>{e.error?i({...o,error:e.error}):i({...o,redirect:!0})})},className:t.submit},"Update")))),f.a.createElement(K.a,{item:!0,xs:6,sm:6},f.a.createElement(Sa,{shopId:e.params.shopId}))))},Na=a(37),Ia=a.n(Na),Ta=a(70),Ca=a.n(Ta),qa=a(38),Oa=a.n(qa),_a=a(71),Aa=a.n(_a),Da=a(72),Ba=a.n(Da),Fa=a(73),Ra=a.n(Fa),La=a(74),Pa=a.n(La),$a=a(75),za=a.n($a);const Ma=Object(Y.makeStyles)(e=>({root:{display:"flex",justifyContent:"center",flexWrap:"wrap","& > *":{margin:e.spacing(1.5,.5)}}})),Ua=e=>{const[t,a]=Object(b.useState)("Grocery"),r=Ma(),n=t=>r=>{a(t),e.onChange(t)},o=()=>{};return f.a.createElement(B.a,null,f.a.createElement("h3",null,"Please Select a Category"),f.a.createElement(ae.a,{elevation:3,className:r.root},f.a.createElement(Ia.a,{icon:f.a.createElement(Aa.a,null),label:"Grocery",color:"primary",onDelete:o,onClick:n("Grocery"),deleteIcon:"Grocery"===t?f.a.createElement(Oa.a,null):f.a.createElement(pa.a,null)}),f.a.createElement(Ia.a,{icon:f.a.createElement(Ba.a,null),label:"Technology",clickable:!0,color:"secondary",onDelete:o,onClick:n("Technology"),deleteIcon:"Technology"===t?f.a.createElement(Oa.a,null):f.a.createElement(pa.a,null)}),f.a.createElement(Ia.a,{icon:f.a.createElement(Ra.a,null),label:"Education",clickable:!0,color:"default",onDelete:o,onClick:n("Education"),deleteIcon:"Education"===t?f.a.createElement(Oa.a,null):f.a.createElement(pa.a,null)}),f.a.createElement(Ia.a,{icon:f.a.createElement(Pa.a,null),label:"Food",clickable:!0,color:"primary",onDelete:o,onClick:n("Food"),deleteIcon:"Food"===t?f.a.createElement(Oa.a,null):f.a.createElement(pa.a,null)}),f.a.createElement(Ia.a,{icon:f.a.createElement(za.a,null),label:"Office",clickable:!0,color:"primary",onDelete:o,onClick:n("Office"),deleteIcon:"Office"===t?f.a.createElement(Oa.a,null):f.a.createElement(pa.a,null)}),f.a.createElement(Ia.a,{icon:f.a.createElement(Ca.a,null),label:"Supplies",clickable:!0,color:"primary",onDelete:o,onClick:n("Supplies"),deleteIcon:"Supplies"===t?f.a.createElement(Oa.a,null):f.a.createElement(pa.a,null)})))};var Ga=Ua;const Wa=Object(Y.makeStyles)(e=>({card:{maxWidth:600,margin:"auto",textAlign:"center",marginTop:e.spacing(5),paddingBottom:e.spacing(2)},error:{verticalAlign:"middle"},title:{marginTop:e.spacing(2),color:e.palette.openTitle,fontSize:"1.2em"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:300},submit:{margin:"auto",marginBottom:e.spacing(2)},input:{display:"none"},filename:{marginLeft:"10px"}}));var Ha=({match:e})=>{const t=Wa(),[a,r]=Object(b.useState)({name:"",description:"",image:null,category:"",quantity:"",price:""}),[n,o]=Object(b.useState)({redirect:!1,submit:!0,shop:{},error:""});Object(b.useEffect)(()=>{ia({shopId:e.params.shopId}).then(e=>{e.error?console.log(err):o({...n,shop:e})})},[e.params.shopId]),f.a.useEffect(()=>{const e=i();o({...n,submit:!e})},[a]);const i=()=>["name","description","category","price"].every(e=>String(a[e]).length>0),l=N(),c=e=>t=>{const n="image"===e?t.target.files[0]:t.target.value;r({...a,[e]:n})};var s;return n.redirect?f.a.createElement(j.Redirect,{to:"/shops/"+(null===(s=n.shop)||void 0===s?void 0:s._id)}):f.a.createElement("div",null,f.a.createElement(me.a,{className:t.card},f.a.createElement(pe.a,null,f.a.createElement(B.a,{type:"headline",component:"h2",className:t.title},`Add New Product To ${n.shop.name} Shop`),f.a.createElement("br",null),f.a.createElement("input",{accept:"image/*",onChange:c("image"),className:t.input,id:"icon-button-file",type:"file"}),f.a.createElement("label",{htmlFor:"icon-button-file"},f.a.createElement(z.a,{variant:"contained",color:"secondary",component:"span"},"Upload Photo",f.a.createElement(oa.a,null))),f.a.createElement("span",{className:t.filename},a.image?a.image.name:""),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"name",label:"Name",className:t.textField,value:a.name,onChange:c("name"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"multiline-flexible",label:"Description",multiline:!0,rows:"2",value:a.description,onChange:c("description"),className:t.textField,margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"quantity",label:"Quantity",className:t.textField,value:a.quantity,onChange:c("quantity"),type:"number",margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"price",label:"Price",className:t.textField,value:a.price,onChange:c("price"),type:"number",margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ga,{onChange:e=>{r({...a,category:e})}}),f.a.createElement("br",null),n.error&&f.a.createElement(B.a,{component:"p",color:"error"},f.a.createElement(ie.a,{color:"error",className:t.error},"error"),n.error)),f.a.createElement(Ft.a,null,f.a.createElement(z.a,{color:"primary",variant:"contained",disabled:n.submit,onClick:()=>{let t=new FormData;a.name&&t.append("name",a.name),a.description&&t.append("description",a.description),a.image&&t.append("image",a.image),a.category&&t.append("category",a.category),a.quantity&&t.append("quantity",a.quantity),a.price&&t.append("price",a.price),(async(e,t)=>{try{return(await fetch("/api/products/by/"+e.shopId,{method:"POST",headers:{Authorization:"Bearer "+e.token,Accept:"application/json"},body:t})).json()}catch(e){console.log(e)}})({shopId:e.params.shopId,token:l.token},t).then(e=>{e.error?o({...n,error:e.error}):o({...n,error:"",redirect:!0})})},className:t.submit},"Submit"),f.a.createElement(j.Link,{to:"/seller/shop/edit/"+e.params.shopId,className:t.submit},f.a.createElement(z.a,{variant:"contained"},"Cancel")))))},Ja=a(46),Va=a.n(Ja);const Qa=Object(Y.makeStyles)(e=>({root:{flexGrow:1,margin:30},flex:{display:"flex"},card:{padding:"24px 40px 40px"},subheading:{margin:"24px",color:e.palette.openTitle},price:{padding:"16px",margin:"16px 0px",display:"flex",backgroundColor:"#93c5ae3d",fontSize:"1.3em",color:"#375a53"},media:{height:200,display:"inline-block",width:"50%",marginLeft:"24px"},icon:{verticalAlign:"sub"},link:{color:"#3e4c54b3",fontSize:"0.9em"},addCart:{width:"35px",height:"35px",padding:"10px 12px",borderRadius:"0.25em",backgroundColor:"#5f7c8b"},action:{margin:"8px 24px",display:"inline-block"}}));var Ya=({match:e})=>{var t;const a=Qa(),[r,n]=Object(b.useState)({shop:{}}),[o,i]=Object(b.useState)({error:"",suggestion:[]});Object(b.useEffect)(()=>{const t=new AbortController,a=t.signal;return xe({productId:e.params.productId},a).then(e=>{e.error?i({...o,error:e.error}):n(e)}),function(){t.abort()}},[e.params.productId]),Object(b.useEffect)(()=>{const t=new AbortController,a=t.signal;return(async(e,t)=>{try{return(await fetch("/api/products/related/"+e.productId,{method:"GET",signal:t})).json()}catch(e){console.log(e)}})({productId:e.params.productId},a).then(e=>{e.error?i({...o,error:e.error}):(console.log("This is the data"),i({...o,suggestion:e}))}),function(){t.abort()}},[e.params.productId]);const l=r._id?`/api/product/image/${r._id}?${(new Date).getTime()}`:"/api/product/defaultphoto";return f.a.createElement("div",{className:a.root},f.a.createElement(K.a,{container:!0,spacing:10},f.a.createElement(K.a,{item:!0,xs:7,sm:7},f.a.createElement(me.a,{className:a.card},f.a.createElement(Va.a,{title:r.name,subheader:r.quantity>0?"In Stock":"OUt of Stock",action:f.a.createElement("span",{className:a.action},f.a.createElement(ze,{cartStyle:a.addCart,item:r}))}),f.a.createElement("div",{className:a.flex},f.a.createElement(ge.a,{className:a.media,image:l,title:r.name}),f.a.createElement(B.a,{component:"p",variant:"subtitle1",className:a.subheading},r.description,f.a.createElement("br",null),f.a.createElement("span",{className:a.price},"$ ",r.price),f.a.createElement(j.Link,{to:"/shops/"+r.shop._id,className:a.link},f.a.createElement("span",null,r.shop.name)))))),(null===(t=o.suggestion)||void 0===t?void 0:t.length)>0&&f.a.createElement(K.a,{item:!0,xs:5,sm:5},f.a.createElement(ye,{products:o.suggestion,title:"Related Products"}))))};const Za=Object(Y.makeStyles)(e=>({card:{margin:"auto",textAlign:"center",marginTop:e.spacing(3),marginBottom:e.spacing(2),maxWidth:500,paddingBottom:e.spacing(2)},title:{margin:e.spacing(2),color:e.palette.protectedTitle,fontSize:"1.2em"},error:{verticalAlign:"middle"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:400},submit:{margin:"auto",marginBottom:e.spacing(2)},bigAvatar:{width:60,height:60,margin:"auto"},input:{display:"none"},filename:{marginLeft:"10px"}}));var Ka=({match:e})=>{const t=Za(),[a,r]=Object(b.useState)({name:"",description:"",image:null,category:"",quantity:"",price:""}),[n,o]=Object(b.useState)({redirect:!1,error:""}),i=N();Object(b.useEffect)(()=>{const t=new AbortController,n=t.signal;return xe({productId:e.params.productId},n).then(e=>{e.error?r({...a,error:e.error}):r({...a,id:e._id,name:e.name,description:e.description,category:e.category,quantity:e.quantity,price:e.price})}),function(){t.abort()}},[]);const l=e=>t=>{const n="image"===e?t.target.files[0]:t.target.value;r({...a,[e]:n})},c=a.id?`/api/product/image/${a.id}?${(new Date).getTime()}`:"/api/product/defaultphoto";return n.redirect?f.a.createElement(j.Redirect,{to:"/seller/shop/edit/"+e.params.shopId}):f.a.createElement("div",null,f.a.createElement(me.a,{className:t.card},f.a.createElement(pe.a,null,f.a.createElement(B.a,{type:"headline",component:"h2",className:t.title},"Edit Product"),f.a.createElement("br",null),f.a.createElement(it.a,{src:c,className:t.bigAvatar}),f.a.createElement("br",null),f.a.createElement("input",{accept:"image/*",onChange:l("image"),className:t.input,id:"icon-button-file",type:"file"}),f.a.createElement("label",{htmlFor:"icon-button-file"},f.a.createElement(z.a,{variant:"contained",color:"secondary",component:"span"},"Change Image",f.a.createElement(oa.a,null)))," ",f.a.createElement("span",{className:t.filename},a.image?a.image.name:""),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"name",label:"Name",className:t.textField,value:a.name,onChange:l("name"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"multiline-flexible",label:"Description",multiline:!0,rows:"3",value:a.description,onChange:l("description"),className:t.textField,margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"quantity",label:"Quantity",className:t.textField,value:a.quantity,onChange:l("quantity"),type:"number",margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"price",label:"Price",className:t.textField,value:a.price,onChange:l("price"),type:"number",margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ga,{onChange:e=>{r({...a,category:e})}}),n.error&&f.a.createElement(B.a,{component:"p",color:"error"},f.a.createElement(ie.a,{color:"error",className:t.error},"error"),n.error)),f.a.createElement(Ft.a,null,f.a.createElement(z.a,{color:"primary",variant:"contained",onClick:()=>{let t=new FormData;a.name&&t.append("name",a.name),a.description&&t.append("description",a.description),a.image&&t.append("image",a.image),a.category&&t.append("category",a.category),a.quantity&&t.append("quantity",a.quantity),a.price&&t.append("price",a.price),(async(e,t)=>{console.log("successful calling",e);try{return(await fetch(`/api/product/${e.shopId}/${e.productId}`,{method:"PUT",headers:{Accept:"application/json",Authorization:"Bearer "+e.token},body:t})).json()}catch(e){console.log(e)}})({shopId:e.params.shopId,productId:e.params.productId,token:i.token},t).then(e=>{e.error?o({...n,error:e.error}):o({...n,redirect:!0})})},className:t.submit},"Update"),f.a.createElement(j.Link,{to:"/seller/shops/edit/"+e.params.shopId,className:t.submit},f.a.createElement(z.a,{variant:"contained"},"Cancel")))))},Xa=a(40);const er=Object(Y.makeStyles)(e=>({card:{margin:"24px 0px",padding:"16px 40px 60px 40px",backgroundColor:"#80808017"},title:{margin:e.spacing(2),color:e.palette.openTitle,fontSize:"1.2em"},price:{color:e.palette.text.secondary,display:"inline"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),marginTop:0,width:50},productTitle:{fontSize:"1.15em",marginBottom:"5px"},subheading:{color:"rgba(88, 114, 128, 0.67)",padding:"8px 10px 0",cursor:"pointer",display:"inline-block"},cart:{width:"100%",display:"inline-flex"},details:{display:"inline-block",width:"100%",padding:"4px"},content:{flex:"1 0 auto",padding:"16px 8px 0px"},cover:{width:160,height:125,margin:"8px"},itemTotal:{float:"right",marginRight:"40px",fontSize:"1.5em",color:"rgb(72, 175, 148)"},checkout:{float:"right",margin:"24px"},total:{fontSize:"1.2em",color:"rgb(53, 97, 85)",marginRight:"16px",fontWeight:"600",verticalAlign:"bottom"},continueBtn:{marginLeft:"10px"},itemShop:{display:"block",fontSize:"0.90em",color:"#78948f"},removeButton:{fontSize:"0.8em"}})),tr=e=>{const t=er(),[a,r]=Object(b.useState)(H()),n=e=>t=>{let n=a;0==t.target.value?n[e].quantity=1:n[e].quantity=t.target.value,r([...n]),((e,t)=>{let a=[];"undefined"!=typeof window&&(localStorage.getItem("cart")&&(a=JSON.parse(localStorage.getItem("cart"))),a[e].quantity=t,localStorage.setItem("cart",JSON.stringify(a)))})(e,t.target.value)},o=t=>a=>{let n=o(t);0==n.length&&e.setCheckout(!1),r(n)};return f.a.createElement(me.a,{className:t.card},f.a.createElement(B.a,{type:"title",className:t.title},"Shopping Cart"),a.length>0?f.a.createElement("span",null,a.map((e,a)=>f.a.createElement("span",{key:a},f.a.createElement(me.a,{className:t.cart},f.a.createElement(ge.a,{className:t.cover,title:e.product.name,image:"/api/product/image/"+e.product._id}),f.a.createElement("div",{className:t.details},f.a.createElement(pe.a,{className:t.content},f.a.createElement(j.Link,{to:"/product/"+e.product._id},f.a.createElement(B.a,{type:"title",component:"h3",className:t.productTitle,color:"primary"},e.product.name)),f.a.createElement("div",null,f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.price,color:"primary"},"$ ",e.product.price),f.a.createElement("span",{className:t.itemTotal},"$",e.product.price*e.quantity),f.a.createElement("span",{className:t.itemShop},"Shop: ",e.product.shop.name))),f.a.createElement("div",{className:t.subheading},"Quantity: ",f.a.createElement(Ne.a,{value:e.quantity,onChange:n(a),type:"number",inputProps:{min:1},className:t.textField,InputLabelProps:{shrink:!0},margin:"normal"}),f.a.createElement(z.a,{className:t.removeButton,color:"primary",onClick:o(a)},"x Remove")))),f.a.createElement(ce.a,null))),f.a.createElement("div",{className:t.checkout},f.a.createElement("span",{className:t.total},"Total:$ ",a.reduce((e,t)=>e+t.quantity*t.product.price,0)),e.checkout?null:N()?f.a.createElement(z.a,{color:"secondary",variant:"contained",onClick:()=>{e.setCheckout(!0)}},"Checkout"):f.a.createElement(j.Link,{to:"/signin"},f.a.createElement(z.a,{color:"primary",variant:"contained"},"Sign in To Proceed to Checkout")))):f.a.createElement(B.a,{variant:"subtitle1",component:"h3",color:"primary"},"No Items added to your cart"))};tr.propTypes={checkout:ee.a.bool.isRequired,setCheckout:ee.a.func.isRequired};var ar=tr;const rr=Object(Y.makeStyles)(e=>({subheading:{color:"rgba(88, 114, 128, 0.87)",marginTop:"20px"},checkout:{float:"right",margin:"20px 30px"},error:{display:"inline",padding:"0px 10px"},errorIcon:{verticalAlign:"middle"},StripeElement:{display:"block",margin:"24px 0 10px 10px",maxWidth:"408px",padding:"10px 14px",boxShadow:"rgba(50, 50, 93, 0.14902) 0px 1px 3px, rgba(0, 0, 0, 0.0196078) 0px 1px 0px",borderRadius:"4px",background:"white"}})),nr=e=>{const t=rr(),[a,r]=Object(b.useState)({order:{},error:"",redirect:!1,orderId:""});return a.redirect?f.a.createElement(j.Redirect,{to:"/order/"+a.orderId}):f.a.createElement("span",null,f.a.createElement(B.a,{type:"subheading",className:t.subheading,component:"h3"},"Card details"),f.a.createElement("div",{className:t.checkout},a.error&&f.a.createElement(B.a,{component:"span",color:"error",className:t.error},f.a.createElement(ie.a,{color:"error",className:t.errorIcon},"error"),a.error),f.a.createElement(z.a,{color:"secondary",variant:"contained",onClick:()=>{const t=N();(async(e,t)=>{try{return(await fetch("/api/orders/"+e.userId,{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.token},body:JSON.stringify({order:t})})).json()}catch(e){console.log(e)}})({userId:t.user._id,token:t.token},e.checkoutDetails).then(e=>{var t;e.error?r({...a,error:e.error}):(console.log("success"),t=()=>{r({...a,orderId:e._id,redirect:!0})},"undefined"!=typeof window&&(localStorage.removeItem("cart"),t()))})}},"Place Order")))};nr.propTypes={checkoutDetails:ee.a.object.isRequired};var or=nr;const ir=Object(Y.makeStyles)(e=>({card:{margin:"24px 0px",padding:"16px 40px 90px 40px",backgroundColor:"#80808017"},title:{margin:"24px 16px 8px 0px",color:e.palette.openTitle},subheading:{color:"rgba(88, 114, 128, 0.87)",marginTop:"20px"},addressField:{marginTop:"4px",marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"45%"},streetField:{marginTop:"4px",marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"93%"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:"90%"}}));var lr=e=>{const t=ir(),a=N().user,[r,n]=Object(b.useState)(""),[o,i]=Object(b.useState)({products:H(),customer_name:a.name,customer_email:a.email,delivery_address:{street:"",city:"",state:"",zipcode:"",country:""}});console.log(o);const l=e=>t=>{let a=o;a[e]=t.target.value||void 0,i({...o,...a})},c=e=>t=>{let{delivery_address:a}=o;a[e]=t.target.value||void 0,i({...o,delivery_address:a})};return f.a.createElement(me.a,{className:t.card},f.a.createElement(B.a,{type:"title",className:t.title},"Checkout"),f.a.createElement(Ne.a,{id:"name",label:"Name",className:t.textField,value:o.customer_name,onChange:l("customer_name"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"email",type:"email",label:"Email",className:t.textField,value:o.customer_email,onChange:l("customer_email"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.subheading},"Delivery Address"),f.a.createElement(Ne.a,{id:"street",label:"Street Address",className:t.streetField,value:o.delivery_address.street,onChange:c("street"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"city",label:"City",className:t.addressField,value:o.delivery_address.city,onChange:c("city"),margin:"normal"}),f.a.createElement(Ne.a,{id:"state",label:"State",className:t.addressField,value:o.delivery_address.state,onChange:c("state"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"zipcode",label:"Zip Code",className:t.addressField,value:o.delivery_address.zipcode,onChange:c("zipcode"),margin:"normal"}),f.a.createElement(Ne.a,{id:"country",label:"Country",className:t.addressField,value:o.delivery_address.country,onChange:c("country"),margin:"normal"}),f.a.createElement("br",null)," ",r.error&&f.a.createElement(B.a,{component:"p",color:"error"},f.a.createElement(ie.a,{color:"error",className:t.error},"error"),o.error),f.a.createElement("div",null,f.a.createElement(Xa.Elements,null,f.a.createElement(or,{checkoutDetails:o}))))};const cr=Object(Y.makeStyles)(e=>({root:{flexGrow:1,margin:30}}));var sr=()=>{const e=cr(),[t,a]=Object(b.useState)(!1);return f.a.createElement("div",{className:e.root},f.a.createElement(K.a,{container:!0,spacing:8},f.a.createElement(K.a,{item:!0,xs:6,sm:6},f.a.createElement(ar,{checkout:t,setCheckout:e=>{a(e)}})),t&&f.a.createElement(K.a,{item:!0,xs:6,sm:6},f.a.createElement(lr,null))))},mr=a(76),dr=a.n(mr),pr=a(77),ur=a.n(pr),gr=a(78),hr=a.n(gr);const Er=Object(Y.makeStyles)(e=>({nested:{paddingLeft:e.spacing(4),paddingBottom:0},listImg:{width:"70px",verticalAlign:"top",marginRight:"10px"},listDetails:{display:"inline-block"},listQty:{margin:0,fontSize:"0.9em",color:"#5f7c8b"},textField:{width:"160px",marginRight:"16px"},statusMessage:{position:"absolute",zIndex:"12",right:"5px",padding:"5px"}})),yr=e=>{const t=Er(),[a,r]=Object(b.useState)({open:0,statusValues:[],error:""}),n=N();Object(b.useEffect)(()=>{const e=new AbortController;e.signal;return(async()=>{try{return(await fetch("/api/order/status_values",{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"}})).json()}catch(e){console.log(e)}})().then(e=>{e.error?r({...a,error:"Could not get status"}):r({...a,statusValues:e,error:""})}),function(){e.abort()}},[]);const o=t=>o=>{let{order:i}=e,{value:l}=o.target;i.products[t].status=l;let c=i.products[t];"Cancelled"==l?(async(e,t)=>{try{return(await fetch(`/api/order/${e.shopId}/cancel/${e.productId}`,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.token},body:JSON.stringify(t)})).json()}catch(e){console.log(e)}})({shopId:e.shopId,productId:c.product._id,token:n.token},{cartItemId:c._id,status:l,quantity:c.quantity}).then(t=>{t.error?r({...a,error:"Status not updated,try again"}):(e.updateOrders(e.orderIndex,i),r({...a,error:""}))}):"Processing"==l?(async(e,t)=>{try{return(await fetch(`/api/order/${e.orderId}/charge/${e.userId}/${e.shopId}`,{method:"PUT",headers:{Authorization:"Bearer "+e.token,"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(t)})).json()}catch(e){console.log(e)}})({userId:n.user._id,shopId:e.shopId,orderId:i._id,token:n.token},{cartItemId:c._id,status:l,amount:c.quantity*c.product.price}).then(t=>{t.error?r({...a,error:"Status not updated,try again"}):(e.updateOrders(e.orderIndex,i),r({...a,error:""}))}):(async(e,t)=>{try{return(await fetch("/api/order/status/"+e.shopId,{method:"PUT",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.token},body:JSON.stringify(t)})).json()}catch(e){console.log(e)}})({shopId:e.shopId,token:n.token},{cartItemId:c._id,status:l}).then(t=>{t.error?r({...a,error:"Status not updated,try again"}):(e.updateOrders(e.orderIndex,i),r({...a,error:""}))})};return f.a.createElement("div",null,f.a.createElement(B.a,{component:"span",color:"error",className:t.statusMessage},a.error),f.a.createElement(Ye.a,{disablePadding:!0,style:{backgroundColor:"#f8f8f8"}},e.order.products.map((r,n)=>f.a.createElement("span",{key:n},r.shop==e.shopId&&f.a.createElement(Ke.a,{button:!0,className:t.nested},f.a.createElement(nt.a,{primary:f.a.createElement("div",null,f.a.createElement("img",{className:t.listImg,src:"/api/product/image/"+r.product._id}),f.a.createElement("div",{className:t.listDetails},r.product.name,f.a.createElement("p",{className:t.listQty},"Quantity: "+r.quantity)))}),f.a.createElement(Ne.a,{id:"select-status",select:!0,label:"Update Status",className:t.textField,value:r.status,onChange:o(n),SelectProps:{MenuProps:{className:t.menu}},margin:"normal"},a.statusValues.map(e=>f.a.createElement(je.a,{key:e,value:e},e)))),f.a.createElement(ce.a,{style:{margin:"auto",width:"80%"}})))))};yr.propTypes={shopId:ee.a.string.isRequired,order:ee.a.object.isRequired,orderIndex:ee.a.number.isRequired,updateOrders:ee.a.func.isRequired};var br=yr;const fr=Object(Y.makeStyles)(e=>({root:e.mixins.gutters({maxWidth:600,margin:"auto",padding:e.spacing(3),marginTop:e.spacing(5)}),title:{margin:`${e.spacing(3)}px 0 ${e.spacing(3)}px ${e.spacing(1)}px`,color:e.palette.protectedTitle,fontSize:"1.2em"},subheading:{marginTop:e.spacing(1),color:"#434b4e",fontSize:"1.1em"},customerDetails:{paddingLeft:"36px",paddingTop:"16px",backgroundColor:"#f8f8f8"}}));var xr=({match:e})=>{const t=fr(),[a,r]=Object(b.useState)([]),[n,o]=Object(b.useState)(0),i=N();Object(b.useEffect)(()=>{const t=new AbortController,a=t.signal;return(async(e,t)=>{try{const a=await fetch("/api/orders/shop/"+e.shopId,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json",Authorization:"Bearer "+e.token},signal:t});return await a.json()}catch(e){console.log(e)}})({shopId:e.params.shopId,token:i.token},a).then(e=>{e.error?console.log(e):r(e)}),function(){t.abort()}},[]);const l=e=>t=>{o(e)},c=(e,t)=>{let n=a;n[e]=t,r([...n])};return console.log(a),f.a.createElement("div",{className:t.root},f.a.createElement(ae.a,{elevation:4},f.a.createElement(B.a,{type:"title",className:t.title},"Orders in ",e.params.shop),f.a.createElement(Ye.a,{dense:!0},a.map((a,r)=>f.a.createElement("span",{key:r},f.a.createElement(Ke.a,{button:!0,onClick:l(r)},f.a.createElement(nt.a,{primary:"Order # "+a._id,secondary:new Date(a.created).toDateString()}),n===r?f.a.createElement(dr.a,null):f.a.createElement(ur.a,null)),f.a.createElement(ce.a,null),f.a.createElement(hr.a,{component:"li",in:n==r,timeout:"auto",unmountOnExit:!0},f.a.createElement(br,{shopId:e.params.shopId,order:a,orderIndex:r,updateOrders:c}),f.a.createElement("div",{className:t.customerDetails},f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.subheading},"Deliver to:"),f.a.createElement(B.a,{type:"subheading",component:"h3",color:"primary"},f.a.createElement("strong",null,a.customer_name),"(",a.customer_email,")"),f.a.createElement(B.a,{type:"subheading",component:"h3",color:"primary"},a.delivery_address.street),f.a.createElement(B.a,{type:"subheading",component:"h3",color:"primary"},a.delivery_address.city,",",a.delivery_address.state,a.delivery_address.zipcode),f.a.createElement(B.a,{type:"subheading",component:"h3",color:"primary"},a.delivery_address.country),f.a.createElement("br",null))))))))};const vr=Object(Y.makeStyles)(e=>({card:{textAlign:"center",paddingTop:e.spacing(1),paddingBottom:e.spacing(2),flexGrow:1,margin:30},cart:{textAlign:"left",width:"100%",display:"inline-flex"},details:{display:"inline-block",width:"100%",padding:"4px"},content:{flex:"1 0 auto",padding:"16px 8px 0px"},cover:{width:160,height:125,margin:"8px"},info:{color:"rgba(83, 170, 146, 0.82)",fontSize:"0.95rem",display:"inline"},thanks:{color:"rgb(136, 183, 107)",fontSize:"0.9rem",fontStyle:"italic"},innerCardItems:{textAlign:"left",margin:"24px 10px 24px 24px",padding:"24px 20px 40px 20px",backgroundColor:"#80808017"},innerCard:{textAlign:"left",margin:"24px 24px 24px 10px",padding:"30px 45px 40px 45px",backgroundColor:"#80808017"},title:{marginTop:e.spacing(2),marginBottom:e.spacing(1),color:e.palette.protectedTitle,fontSize:"1.2em"},subheading:{marginTop:e.spacing(1),color:e.palette.openTitle},productTitle:{fontSize:"1.15em",marginBottom:"5px"},itemTotal:{float:"right",marginRight:"40px",fontSize:"1.5em",color:"rgb(72, 175, 148)"},itemShop:{display:"block",fontSize:"1em",color:"#78948f"},checkout:{float:"right",margin:"24px"},total:{fontSize:"1.2em",color:"rgb(53, 97, 85)",marginRight:"16px",fontWeight:"600",verticalAlign:"bottom"}}));var wr=({match:e})=>{const t=vr(),[a,r]=Object(b.useState)({products:[],delivery_address:{}}),n=N();Object(b.useEffect)(()=>{const t=(new AbortController).signal;return(async(e,t)=>{try{return(await fetch("/api/order/"+e.orderId,{method:"GET",headers:{Authorization:"Bearer "+e.token},signal:t})).json()}catch(e){console.log(e)}})({orderId:e.params.orderId,token:n.token},t).then(e=>{e.error?console.log(e.error):r(e)}),function(){abortContoller.abort()}},[]);return f.a.createElement(me.a,{className:t.card},f.a.createElement(B.a,{type:"headline",component:"h2",className:t.title},"Order Details"),f.a.createElement(B.a,{type:"subheading",component:"h2",className:t.subheading},"Order Code : ",f.a.createElement("strong",null,a._id),f.a.createElement("br",null),"Placed on",new Date(a.created).toDateString()),f.a.createElement("br",null),f.a.createElement(K.a,{container:!0,spacing:4},f.a.createElement(K.a,{item:!0,xs:7,sm:7},f.a.createElement(me.a,{className:t.innerCardItems},a.products.map((e,a)=>f.a.createElement("span",{key:a},f.a.createElement(me.a,{className:t.cart},f.a.createElement(ge.a,{className:t.cover,image:"/api/product/image/"+e.product._id,title:e.product.name}),f.a.createElement("div",{className:t.details},f.a.createElement(pe.a,{className:t.content},f.a.createElement(j.Link,{to:"/product/"+e.product._id},f.a.createElement(B.a,{type:"title",component:"h3",className:t.productTitle,color:"primary"},e.product.name)),f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.itemShop,color:"primary"},"$ ",e.product.price," x ",e.quantity),f.a.createElement("span",{className:t.itemTotal},"$",e.product.price*e.quantity),f.a.createElement("span",{className:t.itemShop},"Shop: ",e.shop.name),f.a.createElement(B.a,{type:"subheading",component:"h3",color:"Cancelled"==e.status?"error":"secondary"},"Status: ",e.status)))))),f.a.createElement("div",{className:t.checkout},f.a.createElement("span",{className:t.total},"Total: $",a.products.reduce((e,t)=>e+("Cancelled"==t.status?0:t.quantity)*t.product.price,0))))),f.a.createElement(K.a,{item:!0,xs:5,sm:5},f.a.createElement(me.a,{className:t.innerCard},f.a.createElement(B.a,{type:"subheading",component:"h2",className:t.productTitle,color:"primary"},"Deliver to:"),f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.info,color:"primary"},f.a.createElement("strong",null,a.customer_name)),f.a.createElement("br",null),f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.info,color:"primary"},a.customer_email),f.a.createElement("br",null),f.a.createElement("br",null),f.a.createElement(ce.a,null),f.a.createElement("br",null),f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.itemShop,color:"primary"},a.delivery_address.street),f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.itemShop,color:"primary"},a.delivery_address.city,", ",a.delivery_address.state," ",a.delivery_address.zipcode),f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.itemShop,color:"primary"},a.delivery_address.country),f.a.createElement("br",null),f.a.createElement(B.a,{type:"subheading",component:"h3",className:t.thanks,color:"primary"},"Thank you for shopping with us! ",f.a.createElement("br",null),"You can track the status of your purchased items on this page.")))))};const Sr=Object(Y.makeStyles)(e=>({card:{maxWidth:600,margin:"auto",textAlign:"center",marginTop:e.spacing(5),paddingBottom:e.spacing(2)},error:{verticalAlign:"middle"},title:{marginTop:e.spacing(2),color:e.palette.openTitle,fontSize:"1em"},textField:{marginLeft:e.spacing(1),marginRight:e.spacing(1),width:300},submit:{margin:"auto",marginBottom:e.spacing(2)},input:{display:"none"},filename:{marginLeft:"10px"}})),jr=e=>{let t=e.getFullYear(),a=1===e.getDate().toString().length?"0"+e.getDate():e.getDate();return`${t}-${1===e.getMonth().toString().length?"0"+(e.getMonth()+1):e.getMonth()+1}-${a}T${1===e.getHours().toString().length?"0"+e.getHours():e.getHours()}:${1===e.getMinutes().toString().length?"0"+e.getMinutes():e.getMinutes()}`};var kr=()=>{const e=Sr(),t=new Date,a=jr(t),r=jr(new Date(t.setHours(t.getHours()+1))),[n,o]=Object(b.useState)({itemName:"",description:"",image:"",bidStart:a,bidEnd:r,startingBid:0,redirect:!1,error:""}),i=N(),l=e=>t=>{const a="image"===e?t.target.files[0]:t.target.value;o({...n,[e]:a})};return n.redirect?f.a.createElement(j.Redirect,{to:"/myauctions"}):f.a.createElement("div",null,f.a.createElement(me.a,{className:e.card},f.a.createElement(pe.a,null,f.a.createElement(B.a,{type:"headline",component:"h2",className:e.title},"New Auction"),f.a.createElement("br",null),f.a.createElement("input",{accept:"image/*",onChange:l("image"),className:e.input,id:"icon-button-file",type:"file"}),f.a.createElement("label",{htmlFor:"icon-button-file"},f.a.createElement(z.a,{variant:"contained",color:"secondary",component:"span"},"Upload Image",f.a.createElement(oa.a,null))),f.a.createElement("span",{className:e.filename},n.image?n.image.name:"Select the image of the Item for auction"),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"name",label:"Item Name",className:e.TextField,value:n.itemName,onChange:l("itemName"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"multiline-flexible",label:"Description",multiline:!0,rows:"2",value:n.description,onChange:l("description"),className:e.textField,margin:"normal"}),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"startingBid",label:"Starting Bid ($)",className:e.textField,value:n.startingBid,onChange:l("startingBid"),margin:"normal"}),f.a.createElement("br",null),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"datetime-local",label:"Auction Start Time",type:"datetime-local",defaultValue:a,className:e.textField,onChange:l("bidStart"),InputLabelProps:{shrink:!0}}),f.a.createElement("br",null),f.a.createElement("br",null),f.a.createElement(Ne.a,{id:"datetime-local",label:"Auction End Time",type:"datetime-local",defaultValue:r,className:e.textField,onChange:l("bidEnd"),InputLabelProps:{shrink:!0}}),f.a.createElement("br",null)," ",f.a.createElement("br",null),n.error&&f.a.createElement(B.a,{component:"p",color:"error"},f.a.createElement(ie.a,{color:"error",className:e.error},"error"),n.error)),f.a.createElement(Ft.a,null,f.a.createElement(z.a,{color:"primary",variant:"contained",onClick:()=>{if(n.bidEnd<n.bidStart)o({...n,error:"Auction cannot end before it starts"});else{let a=new FormData;n.itemName&&a.append("itemName",n.itemName),n.description&&a.append("description",n.description),n.image&&a.append("image",n.image),n.startingBid&&a.append("startingBid",n.startingBid),n.bidStart&&a.append("bidStart",n.bidStart),n.bidEnd&&a.append("bidEnd",n.bidEnd),(e={userId:i.user._id,token:i.token},t=a,fetch("/api/auctions/by/"+e.userId,{method:"POST",headers:{Accept:"application/json",Authorization:"Bearer "+e.token},body:t}).then(e=>e.json()).catch(e=>console.log(e))).then(e=>{e.error?o({...n,error:e.error}):o({...n,error:"",redirect:!0})})}var e,t},className:e.submit},"Submit"),f.a.createElement(j.Link,{to:"/myauctions",className:e.submit},f.a.createElement(z.a,{variant:"contained"},"Cancel")))))};const Nr=Object(Y.makeStyles)(e=>({endTime:{fontSize:"0.75em",color:"#323232",fontWeight:300},subheading:{margin:"16px",color:e.palette.openTitle}})),Ir=e=>{const t=e-new Date;let a={};return a=t>0?{days:Math.floor(t/864e5),hours:Math.floor(t/36e5%24),minutes:Math.floor(t/1e3/60%60),seconds:Math.floor(t/1e3%60),timeEnd:!1}:{timeEnd:!0},a};var Tr=e=>{const t=Nr(),[a,r]=Object(b.useState)(Ir(new Date(e.endTime)));return Object(b.useEffect)(()=>{let t=null;return a.timeEnd?e.update():t=setTimeout(()=>{r(Ir(new Date(e.endTime)))},1e3),()=>{clearTimeout(t)}}),f.a.createElement("div",{className:t.subheading},a.timeEnd?f.a.createElement(B.a,{component:"p",variant:"h6"},"Auction ended"):f.a.createElement(B.a,{component:"p",variant:"h6"},0!=a.days&&a.days+" d ",0!=a.hours&&a.hours+" h ",0!=a.minutes&&a.minutes+" m ","left ",f.a.createElement("span",{className:t.endTime},`(ends at \n                    ${new Date(e.endTime).toLocaleString()})`)))};const Cr=Object(Y.makeStyles)(e=>({bidHistory:{marginTop:"20px",backgroundColor:"#f3f3f3",padding:"16px"},placeForm:{margin:"0px 16px 16px",backgroundColor:"#e7ede4",display:"inline-block"},marginInput:{margin:16},marginBtn:{margin:"8px 16px 16px"}})),qr=a(84)();var Or=e=>{const t=Cr(),[a,r]=Object(b.useState)(""),n=N();Object(b.useEffect)(()=>(qr.emit("join auction room",{room:e.auction._id}),()=>{qr.emit("leave auction room",{room:e.auction._id})}),[]),Object(b.useEffect)(()=>(qr.on("new bid",t=>{console.log("this was called",t),e.updateBids(t)}),()=>{qr.off("new bid")}));console.log(e.auction.bids);const o=e.auction.bids.length>0?e.auction.bids[0].bid:e.auction.startingBid;return f.a.createElement("div",null,!e.justEnded&&new Date<new Date(e.auction.bidEnd)&&f.a.createElement("div",{className:t.placeForm},f.a.createElement(Ne.a,{id:"bid",label:"Your bid ($)",value:a,onChange:e=>{r(e.target.value)},type:"number",helperText:`Enter $${Number(o)+1} or more`,className:t.marginInput}),f.a.createElement("br",null),f.a.createElement(z.a,{variant:"contained",className:t.marginBtn,color:"secondary",disabled:a<o+1,onClick:()=>{let t={bid:a,time:new Date,bidder:n.user};qr.emit("new bid",{room:e.auction._id,bidInfo:t}),r("")}},"Place Bid")),f.a.createElement("div",{className:t.bidHistory},f.a.createElement(B.a,{variant:"h6"},"All bids"),f.a.createElement("br",null),f.a.createElement(K.a,{container:!0,spacing:4},f.a.createElement(K.a,{item:!0,xs:3,sm:3},f.a.createElement(B.a,{variant:"subtitle1",color:"primary"},"Bid Amount")),f.a.createElement(K.a,{item:!0,xs:5,sm:5},f.a.createElement(B.a,{variant:"subtitle1",color:"primary"},"Bid Time")),f.a.createElement(K.a,{item:!0,xs:4,sm:4},f.a.createElement(B.a,{variant:"subtitle1",color:"primary"},"Bidder"))),e.auction.bids.map((e,t)=>f.a.createElement(K.a,{container:!0,spacing:4,key:t},f.a.createElement(K.a,{item:!0,xs:3,sm:3},f.a.createElement(B.a,{variant:"body2"},"$",e.bid)),f.a.createElement(K.a,{item:!0,xs:5,sm:5},f.a.createElement(B.a,{variant:"body2"},new Date(e.time).toLocaleString())),f.a.createElement(K.a,{item:!0,xs:4,sm:4},f.a.createElement(B.a,{variant:"body2"},e.bidder.name))))))};const _r=Object(Y.makeStyles)(e=>({root:{flexGrow:1,margin:60},flex:{display:"flex"},card:{padding:"24px 40px 40px"},subheading:{margin:"16px",color:e.palette.openTitle},description:{margin:"16px",fontSize:"0.9em",color:"#4f4f4f"},price:{padding:"16px",margin:"16px 0px",display:"flex",backgroundColor:"#93c5ae3d",fontSize:"1.3em",color:"#375a53"},media:{height:300,display:"inline-block",width:"100%"},icon:{verticalAlign:"sub"},link:{color:"#3e4c54b3",fontSize:"0.9em"},itemInfo:{width:"35%",margin:"16px"},bidSection:{margin:"20px",minWidth:"50%"},lastBid:{color:"#303030",margin:"16px"}}));var Ar=({match:e})=>{const t=_r(),[a,r]=Object(b.useState)({}),[n,o]=Object(b.useState)(!1),[i,l]=Object(b.useState)({error:"",justEnded:!1}),c=N();Object(b.useEffect)(()=>{const t=new AbortController,a=t.signal;return(async(e,t)=>{try{return(await fetch("/api/auction/"+e.auctionId,{method:"GET",headers:{Accept:"application/json","Content-Type":"application/json"},signal:t})).json()}catch(e){console.log(e)}})({auctionId:e.params.auctionId},a).then(e=>{e.error?l({...i,error:e.error}):r(e)}),function(){t.abort()}},[e.params.auctionId]);const s=a._id?`/api/auctions/image/${a._id}?${(new Date).getTime()}`:"/api/auctions/defaultphoto",m=new Date;return f.a.createElement("div",{className:t.root},f.a.createElement(me.a,{className:t.card},f.a.createElement(Va.a,{title:a.itemName,subheader:f.a.createElement("span",null,m<new Date(a.bidStart)&&"Auction Not Started",m>new Date(a.bidStart)&&m<new Date(a.bidEnd)&&"Auction Live",m>new Date(a.bidEnd)&&"Auction Ended")}),f.a.createElement(K.a,{container:!0,spacing:6},f.a.createElement(K.a,{item:!0,xs:5,sm:5},f.a.createElement(ge.a,{className:t.media,image:s,title:a.itemName}),f.a.createElement(B.a,{component:"p",className:t.subheading,variant:"subtitle1"},"About Item"),f.a.createElement(B.a,{component:"p",className:t.description},a.description)),f.a.createElement(K.a,{item:!0,xs:7,sm:7},m>new Date(a.bidStart)?f.a.createElement(f.a.Fragment,null,f.a.createElement(Tr,{endTime:a.bidEnd,update:e=>{o(!0)}}),a.bids.length>0&&f.a.createElement(B.a,{component:"p",variant:"subtitle1",className:t.lastBid},"Last bid: $ "+a.bids[0].bid),!c&&f.a.createElement(B.a,null,f.a.createElement(j.Link,{to:"/signin"},"Sign in"),"To place your bid"),c&&f.a.createElement(Or,{auction:a,justEnded:n,updateBids:e=>{r(e)}})):f.a.createElement(B.a,{component:"p",variant:"h6"},"Auction Starts at \n                                "+new Date(a.bidStart).toLocaleString())))))};var Dr=()=>f.a.createElement(f.a.Fragment,null,f.a.createElement(Q,null),f.a.createElement(j.Switch,null,f.a.createElement(j.Route,{exact:!0,path:"/users",component:Dt}),f.a.createElement(j.Route,{exact:!0,path:"/cart",component:sr}),f.a.createElement(j.Route,{exact:!0,path:"/signup",component:Mt}),f.a.createElement(j.Route,{exact:!0,path:"/signin",component:Wt}),f.a.createElement(j.Route,{exact:!0,path:"/order/:orderId",component:wr}),f.a.createElement(j.Route,{exact:!0,path:"/product/:productId",component:Ya}),f.a.createElement(C,{path:"/user/edit/:userId",component:ra}),f.a.createElement(j.Route,{exact:!0,path:"/user/:userId",component:Zt}),f.a.createElement(C,{path:"/seller/shop/new",component:ca}),f.a.createElement(C,{exact:!0,path:"/seller/:shopId/:productId/edit",component:Ka}),f.a.createElement(C,{exact:!0,path:"/seller/orders/:shop/:shopId",component:xr}),f.a.createElement(C,{exact:!0,path:"/seller/shop/edit/:shopId",component:ka}),f.a.createElement(C,{path:"/seller/:shopId/products/new",component:Ha}),f.a.createElement(C,{path:"/seller/shops",component:Ea}),f.a.createElement(C,{path:"/auction/new",component:kr}),f.a.createElement(j.Route,{path:"/auction/:auctionId",component:Ar}),f.a.createElement(j.Route,{exact:!0,path:"/shops/all",component:ma}),f.a.createElement(j.Route,{exact:!0,path:"/shops/:shopId",component:ba}),f.a.createElement(j.Route,{exact:!0,path:"/",component:Nt}),f.a.createElement(j.Route,{render:()=>f.a.createElement(j.Redirect,{to:"/"})}))),Br=a(49),Fr=a(79);var Rr=Object(Y.createMuiTheme)({typography:{useNextVariants:!0},palette:{primary:{light:"#5c67a3",main:"#3f4771",dark:"#2e355b",contrastText:"#fff"},secondary:{light:"#ff79b0",main:"#ff4081",dark:"#c60055",contrastText:"#000"},openTitle:"#3f4771",protectedTitle:Fr.pink[400],type:"light"}}),Lr=a(10),Pr=a.n(Lr),$r=a(80),zr=a.n($r);const Mr=new Pr.a.Schema({name:{type:String,trim:!0,required:"Name is required"},stripe_seller:{type:Boolean,default:!1},seller:{type:Boolean,default:!1},email:{type:String,trim:!0,unique:"Email already exists",match:[/.+\@.+\..+/,"Please fill a valid email address"],required:"Email is required"},hashed_password:{type:String,required:"Password is required"},salt:String,updated:Date,created:{type:Date,default:Date.now}});Mr.virtual("password").set((function(e){this._password=e,this.salt=this.makeSalt(),this.hashed_password=this.encryptPassword(e)})).get((function(){return this._password})),Mr.path("hashed_password").validate((function(e){this._password&&this._password.length<6&&(this.invalidate("password","Password must be at least 6 characters."),this.isNew&&!this._password&&this.invalidate("password","Password is required"))}),null),Mr.methods={authenticate:function(e){return this.encryptPassword(e)===this.hashed_password},encryptPassword:function(e){if(!e)return"";try{return zr.a.createHmac("sha1",this.salt).update(e).digest("hex")}catch(e){return""}},makeSalt:function(){return Math.round((new Date).valueOf()*Math.random())+""}};var Ur=Pr.a.model("User",Mr),Gr=a(36),Wr=a.n(Gr);var Hr=e=>{let t="";if(e.code)switch(e.code){case 11e3:case 11001:t=(e=>{let t;try{let a=e.message.substring(e.message.lastIndexOf(".$")+2,e.message.lastIndexOf("_1"));t=a.charAt(0).toUpperCase()+a.slice(1)+" already exists"}catch(e){t="Unique field already exists"}return t})(e);break;default:t="Something went wrong"}else for(let a in e.errors)e.errors[a].message&&(t=e.errors[a].message);return t};var Jr=async(e,t)=>{const a=new Ur(e.body);try{return await a.save(),t.status(200).json({message:"Successfully signed up!"})}catch(e){return t.status(400).json({error:Hr(e)})}},Vr=async(e,t,a,r)=>{try{let n=await Ur.findById(r);if(!n)return t.status(400).json({error:"User Not Found"});e.profile=n,a()}catch(e){return t.status(400).json({error:"Could not retrieve user"})}},Qr=(e,t)=>(e.profile.hashed_password=void 0,e.profile.salt=void 0,t.json(e.profile)),Yr=async(e,t,a)=>{console.log("success"),a()},Zr=async(e,t)=>{try{let e=await Ur.find().select("name email updated created");return t.status(200).json(e)}catch(e){return t.status(400).json({error:Hr(e)})}},Kr=async(e,t)=>{try{let a=e.profile,r=await a.remove();r.hashed_password=void 0,r.salt=void 0,t.json(r)}catch(e){return t.status(400).json({error:Hr(e)})}},Xr=async(e,t)=>{try{let a=e.profile;a=Wr()(a,e.body),a.updated=Date.now(),await a.save(),a.hashed_password=void 0,a.salt=void 0,t.json(a)}catch(e){return console.log("this is the error",e),t.status(400).json({error:Hr(e)})}},en=(e,t,a)=>{var r;if(!(null===(r=e.profile)||void 0===r?void 0:r.seller))return t.status(403).json({error:"User is not a seller"});a()},tn=a(81),an=a.n(tn),rn=a(82),nn=a.n(rn);var on={signin:async function(e,t){try{let a=await Ur.findOne({email:e.body.email});if(!a)return t.status(401).json({error:"User Not Found!!!"});if(!a.authenticate(e.body.password))return t.status(401).json({error:"Password don't match"});const n=nn.a.sign({_id:a._id},r.jwtSecret);return t.cookie("t",n,{expire:new Date+9999}),t.status(200).json({token:n,user:{_id:a._id,name:a.name,email:a.email,seller:a.seller}})}catch(e){return t.status(401).json({error:"Could not sign in"})}},signout:function(e,t){return t.clearCookie("t"),t.status(200).json({message:"Signed out"})},requireSignin:an()({secret:r.jwtSecret,userProperty:"auth",algorithms:["HS256"]}),hasAuthorization:function(e,t,a){var r,n;if(!((null===(r=e.profile)||void 0===r?void 0:r._id)==(null===(n=e.auth)||void 0===n?void 0:n._id)))return t.status(403).json({error:"User is not authorized to perform this action"});a()}};const ln=l.a.Router();ln.route("/api/user").get(Zr).post(Jr),ln.route("/api/user/:userId").get(on.requireSignin,Qr).put(on.requireSignin,on.hasAuthorization,Xr).delete(on.requireSignin,on.hasAuthorization,Kr),ln.param("userId",Vr);var cn=ln;const sn=l.a.Router();sn.route("/auth/signin").post(on.signin),sn.route("/auth/signout").get(on.signout);var mn=sn;const dn=new Pr.a.Schema({name:{type:String,trim:!0,required:"Name is required"},description:{type:String,trim:!0},image:{data:Buffer,contentType:String},owner:{type:Pr.a.Schema.ObjectId,ref:"User"},updated:Date,created:{type:Date,default:Date.now}});var pn=Pr.a.model("Shop",dn),un=a(30),gn=a.n(un),hn=a(31),En=a.n(hn),yn=a.p+"b5e188c92802e96faa6f2b04d236ebb2.png";var bn=(e,t)=>{let a=new gn.a.IncomingForm;a.keepExtensions=!0,a.parse(e,async(a,r,n)=>{a&&t.status(400).json({message:"Image could not be uploaded"});let o=new pn(r);o.owner=e.profile,n.image&&(o.image.data=En.a.readFileSync(n.image.path),o.image.contentType=n.image.type);try{let e=await o.save();console.log("we are here successful"),t.status(200).json(e)}catch(a){return t.status(400).json({error:Hr(a)})}})},fn=(e,t)=>t.sendFile(process.cwd()+yn),xn=(e,t)=>(e.shop.image=void 0,t.json(e.shop)),vn=(e,t,a)=>{var r,n;console.log("we are checking the validity");if(!((null===(r=e.shop)||void 0===r?void 0:r.owner._id)==(null===(n=e.auth)||void 0===n?void 0:n._id)))return t.status("403").json({error:"User is not authorized"});console.log("success"),a()},wn=async(e,t)=>{try{let a=e.shop.remove();t.json(a)}catch(e){return t.status(400).json({error:Hr(e)})}},Sn=async(e,t)=>{try{let e=await pn.find();t.json(e)}catch(e){return t.status(400).json({error:Hr(e)})}},jn=(e,t,a)=>{if(e.shop.image.data)return t.set("Content-Type",e.shop.image.contentType),t.send(e.shop.image.data);a()},kn=async(e,t,a,r)=>{try{let n=await pn.findById(r).populate("owner","_id name").exec();if(!n)return t.status("400").json({error:"Shop not found"});e.shop=n,a()}catch(e){return t.status("400").json({error:"Could not retrieve shop"})}},Nn=async(e,t)=>{try{let a=await pn.find({owner:e.profile._id}).populate("owner","_id name");t.json(a)}catch(e){return t.status(400).json({error:Hr(e)})}},In=(e,t)=>{let a=new gn.a.IncomingForm;a.keepExtensions=!0,a.parse(e,async(a,r,n)=>{a&&t.status(400).json({message:"Photo could not be uploaded"});let o=e.shop;o=Wr()(o,r),o.updated=Date.now(),n.image&&(o.image.data=En.a.readFileSync(n.image.path),o.image.contentType=n.image.type);try{let e=await o.save();t.json(e)}catch(a){return t.status(400).json({error:Hr(a)})}})};const Tn=l.a.Router();Tn.route("/api/shops/by/:userId").post(on.requireSignin,on.hasAuthorization,en,bn).get(on.requireSignin,on.hasAuthorization,Nn),Tn.route("/api/shops").get(Sn),Tn.route("/api/shop/:shopId").get(xn).put(on.requireSignin,vn,In).delete(on.requireSignin,vn,wn),Tn.route("/api/shops/logo/:shopId").get(jn,fn),Tn.route("/api/shops/defaultphoto").get(fn),Tn.param("userId",Vr),Tn.param("shopId",kn);var Cn=Tn;const qn=new Pr.a.Schema({name:{type:String,trim:!0,required:"Name is required"},description:{type:String,trim:!0},image:{data:Buffer,contentType:String},price:{type:Number,required:"Price is required"},category:{type:String},quantity:{type:Number,required:"Quantity is required"},shop:{type:Pr.a.Schema.ObjectId,ref:"Shop"},updated:Date,created:{type:Date,default:Date.now}});var On=Pr.a.model("Product",qn);var _n=(e,t,a)=>{let r=new gn.a.IncomingForm;r.keepExtensions=!0,r.parse(e,async(a,r,n)=>{if(a)return t.status(400).json({message:"Image could not be uploaded"});let o=new On(r);o.shop=e.shop,n.image&&(o.image.data=En.a.readFileSync(n.image.path),o.image.contentType=n.image.type);try{let e=await o.save();t.json(e)}catch(a){return t.status(400).json({error:Hr(a)})}})},An=async(e,t)=>{try{let a=await On.find({shop:e.shop._id}).populate("shop","_id name").select("-image");t.json(a)}catch(e){return t.status(400).json({error:Hr(e)})}},Dn=(e,t)=>t.sendFile(process.cwd()+yn),Bn=(e,t)=>{try{const a=e.product;a.image=void 0,t.json(a)}catch(e){return t.json(400).json({error:Hr(e)})}},Fn=(e,t)=>{let a=new gn.a.IncomingForm;a.keepExtensions=!0,a.parse(e,async(a,r,n)=>{if(a)return t.status(400).json({message:"Photo could not be uploaded"});let o=e.product;o=Wr()(o,r),o.updated=Date.now(),n.image&&(o.image.data=En.a.readFileSync(n.image.path),o.image.contentType=n.image.type);try{let e=await o.save();console.log("successful"),t.json(e)}catch(a){return t.status(400).json({error:Hr(a)})}})},Rn=async(e,t)=>{try{let e=await On.distinct("category",{});t.json(e)}catch(e){return t.status(400).json({error:Hr(e)})}},Ln=async(e,t,a)=>{try{await On.findByIdAndUpdate(e.product._id,{$inc:{quantity:e.body.quantity}},{new:!0}).exec(),a()}catch(e){return t.status(401).json({error:Hr(e)})}},Pn=async(e,t,a,r)=>{try{let n=await On.findById(r).populate("shop","_id name").exec();if(!n)return t.status("400").json({error:"Product not found"});e.product=n,a()}catch(e){return t.status("400").json({error:"Could not retrieve product"})}},$n=(e,t,a)=>{if(e.product.image.data)return t.set("Content-Type",e.product.image.contentType),t.send(e.product.image.data);a()},zn=async(e,t)=>{try{let e=await On.find().sort("-created").limit(5).populate("shop","_id name").exec();t.json(e)}catch(e){return t.status(400).json({error:Hr(e)})}},Mn=async(e,t)=>{try{let a=await On.find({_id:{$ne:e.product},category:e.product.category}).limit(5).populate("shop","_id name").exec();t.json(a)}catch(e){return t.status(400).json({error:Hr(e)})}},Un=async(e,t)=>{try{let a=e.product,r=await a.remove();t.json(r)}catch(e){return t.status(400).json({error:Hr(e)})}},Gn=async(e,t)=>{const a={};e.query.search&&(a.name={$regex:e.query.search,$options:"i"}),e.query.category&&"All"!=e.query.category&&(a.category=e.query.category);try{let e=await On.find(a).populate("shop","_id name").select("-image").exec();t.json(e)}catch(e){return t.status(400).json({error:Hr(e)})}},Wn=async(e,t,a)=>{let r=e.body.order.products.map(e=>({updateOne:{filter:{_id:e.product._id},update:{$inc:{quantity:-e.quantity}}}}));try{await On.bulkWrite(r,{}),console.log("success"),a()}catch(e){return t.status(400).json({error:"Could not update Product"})}};const Hn=l.a.Router();Hn.route("/api/products").get(Gn),Hn.route("/api/products/by/:shopId").get(An).post(on.requireSignin,vn,_n),Hn.route("/api/product/image/:productId").get($n,Dn),Hn.route("/api/product/defaultphoto").get(Dn),Hn.route("/api/products/latest").get(zn),Hn.route("/api/products/related/:productId").get(Mn),Hn.route("/api/products/categories").get(Rn),Hn.route("/api/products/:productId").get(Bn),Hn.route("/api/product/:shopId/:productId").put(on.requireSignin,vn,Fn).delete(on.requireSignin,vn,Un),Hn.param("shopId",kn),Hn.param("productId",Pn);var Jn=Hn;const Vn=new Pr.a.Schema({product:{type:Pr.a.Schema.ObjectId,ref:"Product"},quantity:Number,shop:{type:Pr.a.Schema.ObjectId,ref:"Shop"},status:{type:String,default:"Not processed",enum:["Not processed","Processing","Shipped","Delivered","Cancelled"]}}),Qn=Pr.a.model("CartItem",Vn),Yn=new Pr.a.Schema({customer_name:{type:String,trim:!0,required:"Customer Name is required"},customer_email:{type:String,trim:!0,match:[/.+\@.+\..+/,"Please fill a valid email address"],required:"Email is required"},ordered_by:{type:Pr.a.Schema.ObjectId,ref:"User"},user:{type:Pr.a.Schema.ObjectId,ref:"User"},delivery_address:{street:{type:String,required:"Street is required"},city:{type:String,required:"City is required"},state:{type:String},zipcode:{type:String,required:"Zip Code is required"},country:{type:String,required:"Country is required"}},payment_id:{},products:[Vn],created:{type:Date,default:Date.now},updated:Date}),Zn=Pr.a.model("Order",Yn);var Kn=async(e,t)=>{try{e.body.order.user=e.profile;let a=new Zn(e.body.order),r=await a.save();t.status(200).json(r)}catch(e){return t.status(400).json({error:Hr(e)})}},Xn=async(e,t)=>{try{let a=await Zn.find({"products.shop":e.shop._id}).populate({path:"products.product",select:"_id name price"}).sort("-created").exec();t.json(a)}catch(e){return t.status(400).json({error:errorHandler.getErrorMessage(e)})}},eo=async(e,t)=>{t.json(Qn.schema.path("status").enumValues)},to=async(e,t)=>{try{let a=await Zn.updateOne({"products._id":e.body.cartItemId},{$set:{"products.$.status":e.body.status}});t.json(a)}catch(e){return console.log("there's been an error",e),t.status(400).json({error:Hr(e)})}},ao=async(e,t,a,r)=>{try{let n=await Zn.findById(r).populate("products.product","name price").populate("products.shop","name").exec();if(!n)return t.status(400).json({error:"Order Not Founnd"});e.order=n,a()}catch(e){return console.log("there's been an err",e),t.status(400).json({error:errorHandler.getErrorMessage(e)})}},ro=async(e,t)=>{try{const a=await Zn.find({user:e.profile._id}).sort("-created").exec();t.json(a)}catch(e){return t.status(400).json({error:errorHandler.getErrorMessage(e)})}},no=(e,t)=>t.json(e.order);const oo=l.a.Router();oo.route("/api/orders/user/:userId").get(on.requireSignin,ro),oo.route("/api/order/status_values").get(eo),oo.route("/api/order/:orderId").get(on.requireSignin,no),oo.route("/api/orders/:userId").post(on.requireSignin,Wn,Kn),oo.route("/api/orders/shop/:shopId").get(on.requireSignin,vn,Xn),oo.route("/api/order/status/:shopId").put(on.requireSignin,vn,to),oo.route("/api/order/:shopId/cancel/:productId").put(on.requireSignin,vn,Ln,to),oo.route("/api/order/:orderId/charge/:userId/:shopId").put(on.requireSignin,vn,Yr,to),oo.param("userId",Vr),oo.param("shopId",kn),oo.param("orderId",ao),oo.param("productId",Pn);var io=oo;const lo=new Pr.a.Schema({itemName:{type:String,trim:!0,required:"Item name is required"},description:{type:String,trime:!0},image:{data:Buffer,contentType:String},seller:{type:Pr.a.Schema.ObjectId,ref:"User"},bidStart:{type:Date,default:Date.now},bidEnd:{type:Date,required:"Auction end time is required"},startingBid:{type:Number,default:0},bids:[{bidder:{type:Pr.a.Schema.ObjectId,ref:"User"},bid:Number,time:Date}]},{timestamps:!0});var co=Pr.a.model("Auction",lo);var so=(e,t)=>{let a=new gn.a.IncomingForm;a.keepExtensions=!0,a.parse(e,async(a,r,n)=>{if(a)return t.status(400).json({message:"Image could not be uploaded"});let o=new co(r);o.seller=e.profile,n.image&&(o.image.data=En.a.readFileSync(n.image.path),o.image.contentType=n.image.type);try{let e=await o.save();t.status(200).json(e)}catch(a){return t.status(400).json({error:Hr(a)})}})},mo=async(e,t,a,r)=>{try{const n=await co.findById(r).populate("seller","_id name").populate("bids.bidders","_id name").exec();if(!n)return t.status(400).json({error:"Auction could not be found"});e.auction=n,a()}catch(e){return t.status(400).json({error:"Could not retrieve auction"})}},po=async(e,t)=>{if(e.auction.image.data)return t.set("Content-Type",e.auction.image.contentType),t.send(e.auction.image.data);next()},uo=async(e,t)=>{try{const a=await co.find({seller:e.profile._id}).populate("seller","_id name").populate("bids.bidder","_id name").exec();t.json(a)}catch(e){return console.log("there's an err",e),t.status(400).json({error:Hr(e)})}},go=async(e,t)=>{let a=new gn.a.IncomingForm;a.keepExtensions=!0,a.parse(e,async(a,r,n)=>{a&&t.status(400).json({message:"Photo could not be uploaded"});let o=e.auction;o=Wr()(o,r),o.updated=Date.now(),n.image&&(o.image.data=En.a.readFileSync(n.image.path),o.image.contentType=n.image.type);try{let e=await o.save();t.json(e)}catch(a){return t.status(400).json({error:Hr(a)})}})},ho=async(e,t)=>{console.log("successfull reaching");try{const a=await e.auction.remove();t.json(a)}catch(e){return console.log("there was an err",e),t.status(400).json({error:Hr(e)})}},Eo=(e,t)=>t.sendFile(process.cwd()+yn),yo=async(e,t)=>{try{let e=await co.find({bidEnd:{$gt:new Date}}).sort("bidStart").populate("seller","_id name").populate("bids.bidder","_id name").exec();t.json(e)}catch(e){return console.log("err",e),t.status(400).json({error:Hr(e)})}},bo=async(e,t)=>{try{let a=await co.find({"bids.bidder":e.profile._id}).populate("seller","_id name").populate("bids.bidder","_id name");t.json(a)}catch(e){return t.status(400).json({error:Hr(e)})}},fo=(e,t,a)=>{var r,n;if(!((null===(r=e.auction)||void 0===r?void 0:r.seller._id)&&(null===(n=e.auth)||void 0===n?void 0:n._id)))return t.status(403).json({error:"User is not authorized"});a()},xo=async(e,t)=>(e.auction.image=void 0,t.json(e.auction));const vo=l.a.Router();vo.route("/api/auctions/by/:userId").post(on.requireSignin,on.hasAuthorization,en,so),vo.route("/api/auctions/image/:auctionId").get(po,Eo),vo.route("/api/auctions/defaultphoto").get(Eo),vo.route("/api/auctions").get(yo),vo.route("/api/auctions/bid/:userId").get(bo),vo.route("/api/auctions/by/:userId").get(on.requireSignin,on.hasAuthorization,uo),vo.route("/api/auctions/:auctionId").put(on.requireSignin,fo,go).delete(on.requireSignin,fo,ho),vo.route("/api/auction/:auctionId").get(xo),vo.param("userId",Vr),vo.param("auctionId",mo);var wo=vo;const So=l()(),jo=process.cwd();So.use(s.a.json()),So.use(s.a.urlencoded({extended:!0})),So.use(d()()),So.use(u()()),So.use(y()()),So.use(h()()),So.use("/",wo),So.use("/",cn),So.use("/",mn),So.use("/",Cn),So.use("/",Jn),So.use("/",io),So.use("/dist",l.a.static(o.a.join(jo,"dist"))),So.get("*",(e,t)=>{const a=new Br.ServerStyleSheets,r={},n=v.a.renderToString(a.collect(f.a.createElement(S.a,{location:e.url,context:r},f.a.createElement(Br.ThemeProvider,{theme:Rr},f.a.createElement(Dr,null)))));if(r.url)return t.redirect(303,r.url);const o=a.toString();t.status(200).send((({markup:e,css:t})=>`<!doctype html>\n    <html lang="en">\n    <head>\n        <meta charset="utf-8">\n        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:100,300,400">\n        <link href="https://fonts.googleapis.com/icon?family=Material+Icons"\n        rel="stylesheet">\n    <title>MERN Skeleton</title>\n    </head>\n    <body>\n    <div id="root">${e}</div>\n    <style id="jss-server-side" >${t}</style>\n    <script type="text/javascript" src="/dist/bundle.js"><\/script>\n    </body>\n    </html>`)({markup:n,css:o}))}),So.use((e,t,a,r)=>{"UnauthorizedError"===e.name?a.status(401).json({error:e.name+": "+e.message}):e&&a.status(400).json({error:e.name+": "+e.message})});var ko=So;Pr.a.Promise=global.Promise,Pr.a.connect(r.mongoUri,{useCreateIndex:!0,useUnifiedTopology:!0,useNewUrlParser:!0,useFindAndModify:!1}),Pr.a.connection.on("error",()=>{throw new Error("unable to connect to database: "+r.mongoUri)});(e=>{const t=a(85).listen(e);t.on("connection",e=>{e.on("join auction room",t=>{e.join(t.room)}),e.on("leave auction room",t=>{e.leave(t.room)}),e.on("new bid",e=>{r(e.bidInfo,e.room)})});const r=async(e,a)=>{try{let r=await co.findOneAndUpdate({_id:a,$or:[{"bids.0.bid":{$lt:e.bid}},{bids:{$eq:[]}}]},{$push:{bids:{$each:[e],$position:0}}},{new:!0}).populate("bids.bidder","_id name").populate("seller","_id name").exec();t.to(a).emit("new bid",r)}catch(e){console.log(e)}}})(ko.listen(r.PORT,e=>{e&&console.log(e),console.info("Server started on port %s",r.PORT)}))}]);